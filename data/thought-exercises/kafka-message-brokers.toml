[category]
  id = 5
  title = "Kafka и брокеры сообщений"

[[exercises]]
  id = 1
  exercise = "Со стороны consumer-а. Топик очень высоконагруженый. 8 партиций. Хотим масшрабироваться на стороне consumer-а, читать сообщения побыстрее. Какой способ? Чтобы читать сообщения с одной бизнес-логикой несколькими Spring-приложениями"

[[exercises]]
  id = 2
  exercise = "Три машины в кафке и одна упала. Что с нашей инфой? Инфа постарадает?"

[[exercises]]
  id = 3
  exercise = "Было 2 сервиса (producer, consumer), общались по Kafka. Consumer на каждое сообщение должен проходить большой процесс обогащения, поэтому стали копиться сообщения. Решили в двух pod-ах поднять consumer. Но второй pod не видит сообщений. В чем проблема?"

[[exercises]]
  id = 4
  exercise = "Если у нас несколько брокеров как будут распологаться partition?"

[[exercises]]
  id = 5
  exercise = "У нас есть n partition. Есть ли смысл настроить Spring приложение для увеличения partition?"

[[exercises]]
  id = 6
  exercise = "Consumer group. 10 партиций и консьюмеры не справляются. Что делать?"

[[exercises]]
  id = 7
  exercise = "Есть producer, consumer, consumer record. Consumer record несет в себе key-value. Есть топик, в нем 3 партиции. Мы продьюсим сообщения. Вкакую патртицию попадают сообщения? По каким принципам?"

[[exercises]]
  id = 8
  exercise = "Топик и 3 партиции. Мы создаем одного consumer-a. К каким партициям прицепится consumer? - цепляется ко всем 3 партициям. Создаем еще одного consumera. С такой же group id. И цепляем его к такому же топику. Он тоже подцепится к этим трем партициям? - Kafka ребалансируется, один консьюмер получит 2 партиции, а второй консьюмер получит 1 партицию"

[[exercises]]
  id = 9
  exercise = "Есть 5 консьюмеров. Хотим ими параллельно читать из Kafka, чтобы каждому доставались уникальные сообщения. Можно ли такого достичь?"

[[exercises]]
  id = 10
  exercise = "Есть два сервиса, им нужно общаться между собой. Два топика. Что должно быть реализовано на сервисах?"

[[exercises]]
  id = 11
  exercise = "Есть consumer group c одним consumer-ом и топик с одной партицией, есть задержка в чтении как можно исправить?"

[[exercises]]
  id = 12
  exercise = "Есть брокер и сервис который отправляет в него сообщения. Нужно сделать чтобы сообщения отправлялись всегда даже при сбое, потере питания и т.д"

[[exercises]]
  id = 13
  exercise = "Несколько микросервисов читают из одного топика. Как обеспечить, что один топик, один producer и 3 consumer-а, и все 3 гарантированно должны забрать одно и то же сообщение?"

[[exercises]]
  id = 14
  exercise = "Возможно в Kafka послать сообщения так, чтобы они были получены в том же порядке, как отправлены?"

[[exercises]]
  id = 15
  exercise = "Один сервис продуцирует сообщеня, по сути является продьюсером. Публикует результаты экзаменов учеников. Есть 3 системы, которые потребляют сообщения. Сколько нужно сделать Топиков и Партиций? Если сделаем 1 партицию, что случится? А если 10?"

[[exercises]]
  id = 16
  exercise = "Возможно обрабатывать несколькими консьюмерами одну партицию?"

[[exercises]]
  id = 17
  exercise = "Как на стороне консьюмера обрабатывать сообщения, чтобы не обрабатывать дубли?"

[[exercises]]
  id = 18
  exercise = "Консьюмер отвалился, продьюсер есть, сообщения идут в топик. Консьюмеров на топике нет. Потеряются ли сообщения? Когда консьюмер поднимется, придут ли к нему пропущенные сообщения?"

[[exercises]]
  id = 19
  exercise = "Consumer не существует. Топик существует, Продюсеры что-то туда откидывают. Создаю нового Консьюмера. Есть ли возможность получить все сообщения, которые были до этого? Скажем так, остались в этом Топике"

[[exercises]]
  id = 20
  exercise = "Консьюмер подключился к Топику и считывает сообщения. В одном из сообщений вылетело необработанное исключение. Что будет с ним?"

[[exercises]]
  id = 21
  exercise = "1 продьюсер, 1 топик, 2 консьюмера. Продьюсер посылает ивент. Кто из консьюмеров получит ивент?"

[[exercises]]
  id = 22
  exercise = "Что делать если у нас 1000 listener в kafka?"

[[exercises]]
  id = 23
  exercise = "Есть топик. 2 партиции. Отправляем одно сообщение. Есть два потребителя. Есть два варианта. Первый, у них одна консьюмер группа. Второй, у них разные консьюмер группы. В каком случае оба микросервиса прочитают одно и тоже сообщение."

[[exercises]]
  id = 24
  exercise = "Что будет если консьюмеров будет больше чем партиций?"

[[exercises]]
  id = 25
  exercise = "Что будет если партиций будет больше чем консьюмеров?"

[[exercises]]
  id = 26
  exercise = "1000 сообщений в секундку, как нам определить, что пришедший ответ из kafka тот, который нам нужен. "

[[exercises]]
  id = 27
  exercise = "Можно в RabbitMQ послать сообщение напрямую или нужно вводить промежуточные сущности?"

[[exercises]]
  id = 28
  exercise = "Как будет вести себя консьюмеры, если количество консьюмеров меньше чем количество партиций в топике? А если 10 Консьюмеров а Партиций пять. Как распределятся?"

[[exercises]]
  id = 29
  exercise = "Несколько Consumer в группе читает из одного Топика. Какой то Consumer отказал. Нужно чтобы другой Consumer стал читать из Топика вместо отказавшего."

[[exercises]]
  id = 30
  exercise = "Есть Consumer зависает, какие последствия могут возникнуть?"

[[exercises]]
  id = 31
  exercise = "Если два контейнера будут в одной сети, какие будут проблемы?"

[[exercises]]
  id = 32
  exercise = "Есть однопоточный лиснер Kafk-и, но нужно параллельно обрабатывать то, что оттуда приходит. Как бы ты это сделал? Нельзя использовать батчевый лиснер Kafk-и"

[[exercises]]
  id = 33
  exercise = "Нужно, чтобы один консьюмер всегда обрабатывал один и тот же тип сообщений. Как реализовать?"

[[exercises]]
  id = 34
  exercise = "У нас 4 партиции и 4 консьюмера. Потом добавляется еще один Консьюмер. Что будет?"

[[exercises]]
  id = 35
  exercise = "Два топика, три партиции, два консьюмера из одной группы. Как распределятся партиции по консьюмерам?"

[[exercises]]
  id = 36
  exercise = "Что если выставил  batch size условно 10 кб. В итоге рейт очень маленький. Пишешь по одному сообщению в минуту. Как это исправить?"

[[exercises]]
  id = 37
  exercise = "Есть Консьюмер группа. 2 консьюмера читают из топика из 4 партиций. Что произойдет если один из консьюмеров в группе сдохнет?"

[[exercises]]
  id = 38
  exercise = "Можно сделать, чтобы несколько консюмеров читали несколько партиций?"

[[exercises]]
  id = 39
  exercise = "У тебя 3 партиции и 1 консюмер. В первую ты закидываешь миллион, во вторую тысячу сообщений, а в третью десять. Как будет происходить чтение этим консюмером?"

[[exercises]]
  id = 40
  exercise = "K8s, контейнеризованное приложение. Есть Kafka топик, в нем 40 партиций. Есть сервис, поднят один под. Ты захотел сделать 5 подов. У всех 5 подов одна консьюмер группа. Все они подписаны на этот топик Kafka. Какой под из какой партиции будет читать?"

[[exercises]]
  id = 41
  exercise = "Kafka. We have one topic. Producer produces temperature updates into topic. On the other side we want to have one app that reads temp updates and shows them. And second app that also reads the same temp updates and send the email. We want both apps to recieve all the updates. What should we do?"

[[exercises]]
  id = 42
  exercise = "Kafka. What should you do if you want to create Load Balancer: we want to have 3-4 apps that can process tasks from one topic? Different apps should process different messages. How many partitions? How many consumer groups?"

[[exercises]]
  id = 43
  exercise = "Kafka. Если нужно сделать паузу в Consumer Kafka, что использовать? Как остановить Consumer на 5 сек? Какие способы остановки потока знаешь? Какой будет хороший?"

[[exercises]]
  id = 44
  exercise = "Kafka. В Consumer Group большой лаг. Как будешь исследовать проблему? В топике 1 млн невычитанных сообщений, и их количество только увеличивается"

[[exercises]]
  id = 45
  exercise = "Есть топик, в который публикуется информация, которая нужна разным микросервисам. Если два микросервиса оба подключатся, как сделать так, чтобы каждое сообщение попало в каждый микросервис. Как правильно объединить или не объединять в консьюмер группу в этом случае?"

[[exercises]]
  id = 46
  exercise = "Система публикует статусы заказа: создан, оплачен, еще что-то. Второй сервис принимает сообщения, у него консьюмер группа из двух консьюмеров, которые поделили партиции топика на себя. В продьюсере создали заказ, отправили сообщение - оно попало первому консьюмеру. Создали второе сообщение по этому же заказу - оно попало второму консьюмеру, который оказался быстрее, чем первый. И сообщения прочитались в неверном порядке. Как этого избежать?"

[[exercises]]
  id = 47
  exercise = "У нас есть два сервиса, которые общаются по кафке. Один отправляет команду второму на запуск симуляции. Второй ее получил и ответил первому, что он получил команду и запустил симуляцию. Но произошла проблема с сетью и первый сервис не получил это сообщение, из-за чего повторно отправил команду второму на запуск симуляции. Как настроить все так, чтобы не происходил повторный запуск?"

[[exercises]]
  id = 48
  exercise = "Есть два сервиса: serviceA, serviceB. serviceB занимается обработкой платежей, например, есть команда: переведи от Пети к Васе 100 руб. serviceA получает от пользователя запрос: переведи от Пети к Васе 100 руб. И serviceA отправляет через Kafka этот запрос в serviceB. Сервис важный, мы хотим, чтобы деньги переходили ровно один раз при одном запросе. Как обеспечить семантику обработки exactly once для этого взаимодействия между сервисами?"

[[exercises]]
  id = 49
  exercise = "Есть топик, в него кто-то пишет. Есть два независимых микросервиса, которые не знают друг про друга. Они должны к топику подключиться. Как настроить микросервисы так, чтобы они не подворовывали друг у друга сообщения из топика?"

[[exercises]]
  id = 50
  exercise = "Если видео ролики нельзя пережать до нужного размера. Какой может быть обходной вариант с пересылкой в Kafka?"

[[exercises]]
  id = 51
  exercise = "Есть топик с 5 партициями. И есть consumer group с одним консьюмером. Как он будет читать топик? Все партиции? Только одну партицию? Мы используем subscribe"

[[exercises]]
  id = 52
  exercise = "Консьюмеров стало 10 в одной consumer group. А партиций пять в топике. Как распределятся консьюмеры?"

[[exercises]]
  id = 53
  exercise = "Есть два сервиса: serviceA, serviceB. serviceB занимается обработкой платежей, например, есть команда: переведи от Пети к Васе 100 руб. serviceA получает от пользователя запрос: переведи от Пети к Васе 100 руб. И serviceA отправляет через Kafka этот запрос в serviceB. Сервис важный, мы хотим, чтобы деньги переходили ровно один раз при одном запросе. Как обеспечить семантику обработки exactly once для этого взаимодействия между сервисами?"

[[exercises]]
  id = 54
  exercise = "Много партиций, таски накидали. Мы их вычитываем консьюмерами. Хотим как можно больше консьюмеров добавить, чтобы они в параллель все больше вычитывали. В какой момент надо остановиться в количестве консьюмеров?"

[[exercises]]
  id = 55
  exercise = "Есть 2 инстанса приложения, которые читают один и тот же топик. Один из инстансов это просто реплика, которая хочет получать те же самые сообщения, что и первый инстанс"

[[exercises]]
  id = 56
  exercise = "Есть 1 продюсер, есть 1 консьюмер. Несколько партиций топика. Продюсер в некотором порядке записывает сообщения в топик. Гарантируется ли, что консьюмер вычитает в том же порядке?"

[[exercises]]
  id = 57
  exercise = "В техническом стеке проекта Kafka и Postgres. Нам говорят, что мы не можем оставить Postgres, только Kafka. Как нам придумать решение, когда только в Kafka храним и состояние объектов, и реальные запросы. На сколько далеко можем продвинуться в использовании Kafka как БД? Какие механизмы Kafka нам помогут? Есть топик Kafka. Сервис накидал туда сообщений со счетами на оплату. Их кто-то может вычитать. Сообщения в Kafka не хранятся вечно. Состояние утеряно. Другие счета прилетели. Пользователей тоже храним, у них фамилии, статусы хранятся. Что делать? Увеличили время хранения сообщений в Kafka. Записи копятся, память сильно растет, когда-то точно закончится. Сущности часто меняются, в топике сто тыс состояний каждого пользователя. Что делать с историчностью, чтобы система не слегла? Нужно только несколько конечных состояний каждого пользователя"

[[exercises]]
  id = 58
  exercise = "Работает брокер, в топике 3 партиции. Подняли 3 приложения (консьюмера). Поняли, что 3 приложения не справляются. Как не выключая ничего, добавить еще консьюмеров, чтобы они быстрее читали из топика? Какие есть возможности, чтобы 5 консьюмеров читали из 3 партиций?"

[[exercises]]
  id = 59
  exercise = "Ты разрабатываешь консьюмера для системы с доставкой минимум 1 раз. Что он должен учитывать?"

[[exercises]]
  id = 60
  exercise = "Может ли быть в Kafka такая проблема, что каждый раз при запуске приложения оно будет идти по всем опубликованным сообщениям с нуля? Если неправильно настроена гарантия доставки. А еще какие проблемы могут быть, что каждый перезапуск приложения заново читаются с нуля все сообщения?"

[[exercises]]
  id = 61
  exercise = "Допустим в транзакции мы записали в outbox таблицу слушатель получил данные и отправил их в kafka соответственно он помечает что отправил и ему не удалось записать, потом сервис мы переподняли у него есть outbox он смотрит не доставленные сообщения видит это сообщение которое не пометил и заново доставляет разве это exactly once?"

[[exercises]]
  id = 62
  exercise = "Одно и то же приложение ставится в два контура: промышленный и резервный. Нужно, чтобы каждый контур получал какое-то уведомление. Приложение одно и то же, читает одну и ту же Kafka. Что нужно сделать, чтобы оба контура получали уведомление?"

[[exercises]]
  id = 63
  exercise = "Есть 5 партиций в топике. Мы вычитываем его каким-то сервисом и хотим максимально ускорить. Сначала сделали 1 consumer, поняли, что медленно, добавили второй consumer. До скольки consumer-ов имеет смысл увеличивать? Почему?"

[[exercises]]
  id = 64
  exercise = "Продюсер один, он пишет сообщения в топик в каком-то порядке. Консьюмер один, читает сообщения. Партиций много. Гарантируется ли, что консьюмер будет сообщения в том же порядке, в каком продюсер пишет?"

[[exercises]]
  id = 65
  exercise = "Есть несколько инстансов микросервиса. Они читают один и тот же топик. Какой механизм позволит избежать дублирования обработки сообщений из топика?"

[[exercises]]
  id = 66
  exercise = "За счет чего происходит то, что каждый консьюмер находит свою партицию?"

[[exercises]]
  id = 67
  exercise = "У тебя есть интегратор, который читает данные из Kafka. Он один. Поняли, что нас не устраивает скорость обработки данных и добавили еще пять экземпляров. Опиши, что произойдет. Поможет ли это нам? По умолчанию одна партиция."

[[exercises]]
  id = 68
  exercise = "С какой проблемой можем столкнуться. Если засунем в обработчик Kafka допустим, параллельную обработку. Многопоточность. Решили засунуть в метод чтения данных многопоточность"

[[exercises]]
  id = 69
  exercise = "Со стороны Consumer ты вычитываешь сообщение, по сообщению тебе надо сходить, несколько интеграций сделать. Ты идешь в первую интеграцию, и получаешь ошибку. Что можно сделать, чтобы еще раз это сообщение обработать? Как это организовать? Как это в коде это сделать (сдвигать offset в Kafka назад)? Как автоматизировать? Читаешь сообщение, у нее идет 3 интеграции. Всегда есть шанс, что одна из интеграций приляжет"

[[exercises]]
  id = 70
  exercise = "У тебя стоит @Listener, ты получил сообщение, десериализовал его в какой то объект. Что в этот момент сразу произошло в кафке?"

[[exercises]]
  id = 71
  exercise = "В топик Kafka попадает 10 сообщений, из топика читают два консьюмера с разными консьюсер группами. Сколько сообщений считает каждый консьюмер. А если в одной консьюмер группе?"

[[exercises]]
  id = 72
  exercise = "Настроили Kafka. Обмен пошел. Перегоняем JSON между сервисами. Потом я пришел и послал в этот топик String. Что будет?"

[[exercises]]
  id = 73
  exercise = "Есть топик в нем пять партиций. Есть 10 слушателей у каждого топика. Каждый из них сможет прочитать?"

[[exercises]]
  id = 74
  exercise = "Пусть у нас min.insync.replicas на топике 5, брокеров у нас 6. При этом настроим на consume'е acks=all. Что это будет означать?"

[[exercises]]
  id = 75
  exercise = "Пусть у нас 10 партиций. Какое количество pod имело бы смысл масшатибровать горизонтально?"

[[exercises]]
  id = 76
  exercise = "Есть PaymentService и TransactionHistoryService. После каждого проведения оплаты, тебе нужно передавать в Kafka информацию о транзакции. В TransactionHistoryService должен быть kafka-listner, который примет это сообщение и сохранит в БД. Нам нельзя терять информацию. Как бы ты реализовал гарантию доставки и гарантию обработки сообщений?"

[[exercises]]
  id = 77
  exercise = "Есть один producer, он пулит сообщения в Kafka. Как сделать так, чтобы два разных сервиса прочитали сообщения из этого топика?"

[[exercises]]
  id = 78
  exercise = "Есть топик, мы консьюмером что-то из него читаем. У нас микросервисы. Нагрузка увеличилась. Датчики стали много всего писать. Наш один консьюмер не справляется все вычитывать. Как в Kafka с этим справляются?"

[[exercises]]
  id = 79
  exercise = "В outbox лежит запись, шедулер пытается отправить ее в Kafka. У нас лежит запись в базе. Мы отправляем событие в Kafka, запись в базу не прошла. Шедулер считает, что событие не отправлено, отправляем его повторно. Запись в БД проходит и мы считаем что событие отправлено. Получается, что в Kafka происходят два события, по одной и той же записью. Как это решить?"

[[exercises]]
  id = 80
  exercise = "По организации топиков, консьюмеров. Есть 50 консьюмеров. Что нужно сделать, чтобы все консьюмеры что-то вычитывали с одного топика?"

[[exercises]]
  id = 81
  exercise = "Есть 2 сервиса, которые параллельно обрабатывают одни и те же сообщения и пишут в разные места. Тогда сколько консьюмер групп?"

[[exercises]]
  id = 82
  exercise = "Неблокирующую обработку в Kafka можно создать двумя способами. Какими?"

[[exercises]]
  id = 83
  exercise = "Есть топики, есть партиции, допустим две. Каждая партиция это отделный набор сообщений по своим offset. В двух партиция может быть одинакой offset. Если для каждой консюмер группы хранить один offset на топик, то мы не знаем к какой партиции этот offset относится. "

[[exercises]]
  id = 84
  exercise = "Есть пять топиков. Каждый из них считается отдельной Consumer Group. И мы в один топик добавляем еще одного Консюмера. Где будет происходить ребалансировка и что с чем?"

[[exercises]]
  id = 85
  exercise = "Есть 3 брокера. Есть 3 партиций, или 6 партиций. За счет чего достигается отказоустойчивость?"

[[exercises]]
  id = 86
  exercise = "Есть много реплик в Kafka. Мы хотим гарантировать сохранение сообщения, но не записывать на все реплики. Что сделать? В топике 100 партиций"

[[exercises]]
  id = 87
  exercise = "У тебя есть сообщение с одним и тем же ключом. Ты можешь записать их в несколько партиций?"
