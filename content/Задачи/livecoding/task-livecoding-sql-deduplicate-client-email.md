#### 38. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –∏–∑-–∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞ –≤ email

**–£—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞—á–∏:**  
üìå –ï—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ `client_service` —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏:
- `client_id` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞
- `employee_email` ‚Äî –ø–æ—á—Ç–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, –æ–±—Å–ª—É–∂–∏–≤–∞—é—â–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞

–ò–∑-–∑–∞ —Ä–∞–∑–Ω–æ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞ –≤ `employee_email` (‚ÄúUser@domain.com‚Äù –∏ ‚Äúuser@domain.com‚Äù) –ø–æ—è–≤–ª—è—é—Ç—Å—è –¥—É–±–ª–∏–∫–∞—Ç—ã –∑–∞–ø–∏—Å–µ–π. –ù—É–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å SQL-—Ä–µ—à–µ–Ω–∏–µ, —á—Ç–æ–±—ã —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –∑–∞–¥–≤–æ–µ–Ω–∏–µ.

{{< hint warning >}}  
**–°–ø–æ–π–ª–µ—Ä—ã –∫ —Ä–µ—à–µ–Ω–∏—é**  
{{< /hint >}}

{{< details "–ü–æ–¥—Å–∫–∞–∑–∫–∏" close >}}  
üí° –ü—Ä–∏–≤–µ–¥–∏—Ç–µ `employee_email` –∫ –æ–¥–Ω–æ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫ –Ω–∏–∂–Ω–µ–º—É) –ø—Ä–∏ –≤—ã–±–æ—Ä–∫–µ –∏–ª–∏ –≤ —Å–∞–º–æ–π —Ç–∞–±–ª–∏—Ü–µ.  
üí° –î–ª—è –≤—ã–±–æ—Ä–∫–∏ –±–µ–∑ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `SELECT DISTINCT ‚Ä¶ LOWER(employee_email)`.  
üí° –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å **—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å** –ø–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—é `LOWER(employee_email)`, —á—Ç–æ–±—ã –≤ –±—É–¥—É—â–µ–º –∏–∑–±–µ–∂–∞—Ç—å –≤—Å—Ç–∞–≤–∫–∏ –¥—É–±–ª–µ–π —Å —Ä–∞–∑–Ω—ã–º —Ä–µ–≥–∏—Å—Ç—Ä–æ–º.  
{{< /details >}}

{{< details "–†–µ—à–µ–Ω–∏–µ" close >}}
```sql
-- 1. –í—ã–±–æ—Ä–∫–∞ –±–µ–∑ –∑–∞–¥–≤–æ–µ–Ω–∏—è –ø–æ —Ä–∞–∑–Ω–æ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É:
SELECT DISTINCT
  client_id,
  LOWER(employee_email) AS employee_email_normalized
FROM client_service;

-- 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ:
UPDATE client_service
SET employee_email = LOWER(employee_email);

-- 3. –°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ –ø–æ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É email:
--    –í PostgreSQL –º–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º:
CREATE UNIQUE INDEX ux_client_service_email_ci
  ON client_service (client_id, LOWER(employee_email));
````

‚úÖ **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è:**

- **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞** —á–µ—Ä–µ–∑ `LOWER(employee_email)` —É—Å—Ç—Ä–∞–Ω—è–µ—Ç —Ä–∞–∑–ª–∏—á–∏—è –≤ —Ä–µ–≥–∏—Å—Ç—Ä–µ.

- **SELECT DISTINCT** –ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–µ—Ä–Ω—ë—Ç –ø–æ –æ–¥–Ω–æ–º—É —Å–æ—á–µ—Ç–∞–Ω–∏—é –∫–ª–∏–µ–Ω—Ç‚Äì–ø–æ—á—Ç–∞.

- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ** —Ç–∞–±–ª–∏—Ü—ã –∏ **—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å** –Ω–µ –ø–æ–∑–≤–æ–ª—è—Ç –≤–Ω–æ–≤—å –≤—Å—Ç–∞–≤–∏—Ç—å –¥—É–±–ª–∏ —Å —Ä–∞–∑–Ω—ã–º —Ä–µ–≥–∏—Å—Ç—Ä–æ–º.  
  {{< /details >}}