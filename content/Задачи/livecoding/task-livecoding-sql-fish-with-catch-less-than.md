#### 26. –†—ã–±—ã —Å —Å—É–º–º–∞—Ä–Ω—ã–º —É–ª–æ–≤–æ–º –Ω–∞ –¥–∞—Ç—É d –º–µ–Ω–µ–µ n


**–£—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞—á–∏:**  
üìå –ï—Å—Ç—å —Ç–∞–±–ª–∏—Ü—ã:  
- **fish** (`id`, `name`)  
- **catch** (`id`, `fish_id`, `dt`, `quantity`)  

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–≤–µ—Å—Ç–∏ **–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ä—ã–±**, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö **—Å—É–º–º–∞—Ä–Ω—ã–π —É–ª–æ–≤** –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é –¥–∞—Ç—É `d` **–º–µ–Ω—å—à–µ** —á–µ–º `n`.

{{< hint warning >}}  
**–°–ø–æ–π–ª–µ—Ä—ã –∫ —Ä–µ—à–µ–Ω–∏—é**  
{{< /hint >}}

{{< details "–ü–æ–¥—Å–∫–∞–∑–∫–∏" close >}}  
üí° –§–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ –¥–µ–ª–∞–µ—Ç—Å—è –≤ `WHERE dt = :d`.  
üí° –°—É–º–º–∞—Ä–Ω—ã–π —É–ª–æ–≤ —Å—á–∏—Ç–∞–µ–º —á–µ—Ä–µ–∑ `SUM(quantity)` –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É –ø–æ `fish_id`.  
üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `HAVING SUM(quantity) < :n` –¥–ª—è –ø–µ—Ä–≤–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.  
üí° –í–æ –≤—Ç–æ—Ä–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å **–ø–æ–¥–∑–∞–ø—Ä–æ—Å** –ª–∏–±–æ **LEFT JOIN** –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –∞–≥—Ä–µ–≥–∞—Ç—É.  
{{< /details >}}

{{< details "–†–µ—à–µ–Ω–∏–µ" close >}}
-- –†–µ—à–µ–Ω–∏–µ 1: GROUP BY + HAVING  
```sql
SELECT f.name
FROM fish f
JOIN catch c ON f.id = c.fish_id
WHERE c.dt = :d
GROUP BY f.name
HAVING SUM(c.quantity) < :n;
```

-- –†–µ—à–µ–Ω–∏–µ 2: –ü–æ–¥–∑–∞–ø—Ä–æ—Å –≤ WHERE

```sql
SELECT f.name
FROM fish f
WHERE (
    SELECT COALESCE(SUM(c.quantity), 0)
    FROM catch c
    WHERE c.fish_id = f.id
      AND c.dt = :d
) < :n;
```

{{< /details >}}