#### 61. –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –ª–µ—Ç–∞–ª–∏ —Ç–æ–ª—å–∫–æ —ç–∫–æ–Ω–æ–º–æ–º

**–£—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞—á–∏:**  
üìå –ù—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å **—É–Ω–∏–∫–∞–ª—å–Ω—ã–µ user_id**, –∫–æ—Ç–æ—Ä—ã–µ **–ª–µ—Ç–∞–ª–∏ —Ç–æ–ª—å–∫–æ –ø–æ –±–∏–ª–µ—Ç–∞–º –∫–ª–∞—Å—Å–∞ ECONOMY**.  
–ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è **—Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –±–∏–ª–µ—Ç BUSINESS**, –æ–Ω **–Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞—Å—Ç—å** –≤ –≤—ã–±–æ—Ä–∫—É.

**–î–∞–Ω–Ω—ã–µ:**

```
ticket_id | user_id | ticket_type | price
-----------+---------+--------------+-------
110        | 500     | 'ECONOMY'    | 10000
220        | 600     | 'BUSINESS'   | 35000
330        | 600     | 'ECONOMY'    | 15000
440        | 750     | 'ECONOMY'    | 12000
550        | 800     | 'BUSINESS'   | 40000
660        | 750     | 'ECONOMY'    | 5000
```

---

{{< hint warning >}}  
**–°–ø–æ–π–ª–µ—Ä—ã –∫ —Ä–µ—à–µ–Ω–∏—é**  
{{< /hint >}}

---

{{< details "–ü–æ–¥—Å–∫–∞–∑–∫–∏" close >}}  
üí° –ù—É–∂–Ω–æ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –±–∏–ª–µ—Ç—ã –ø–æ `user_id`.  
üí° –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–¥–∏—Ç—Å—è, –µ—Å–ª–∏ `MIN(ticket_type) = MAX(ticket_type) = 'ECONOMY'`.  
üí° –ò–ª–∏: —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `COUNT(*) = COUNT(CASE WHEN ticket_type='ECONOMY' THEN 1 END)`.  
üí° –ò–ª–∏: –∏—Å–∫–ª—é—á–∏—Ç—å —Ç–µ—Ö, —É –∫–æ–≥–æ –µ—Å—Ç—å BUSINESS.  
{{< /details >}}

---

{{< details "–†–µ—à–µ–Ω–∏–µ" close >}}

### ‚úîÔ∏è –í–∞—Ä–∏–∞–Ω—Ç 1 ‚Äî —á–µ—Ä–µ–∑ GROUP BY + HAVING

```sql
SELECT user_id
FROM tickets
GROUP BY user_id
HAVING COUNT(*) = COUNT(CASE WHEN ticket_type = 'ECONOMY' THEN 1 END);
```

**–õ–æ–≥–∏–∫–∞:**  
–ï—Å–ª–∏ –æ–±—â–µ–µ —á–∏—Å–ª–æ –±–∏–ª–µ—Ç–æ–≤ = —á–∏—Å–ª—É ECONOMY-–±–∏–ª–µ—Ç–æ–≤ ‚Üí –¥—Ä—É–≥–∏—Ö –∫–ª–∞—Å—Å–æ–≤ –Ω–µ—Ç.

---

### ‚úîÔ∏è –í–∞—Ä–∏–∞–Ω—Ç 2 ‚Äî ¬´–∑–∞–ø—Ä–µ—Ç–∏—Ç—å –±–∏–∑–Ω–µ—Å¬ª (—Ç–æ–∂–µ –≤–µ—Ä–Ω–æ)

```sql
SELECT user_id
FROM tickets
GROUP BY user_id
HAVING SUM(CASE WHEN ticket_type = 'BUSINESS' THEN 1 ELSE 0 END) = 0;
```

---

### ‚úîÔ∏è –í–∞—Ä–∏–∞–Ω—Ç 3 ‚Äî —á–µ—Ä–µ–∑ NOT EXISTS

```sql
SELECT DISTINCT t1.user_id
FROM tickets t1
WHERE NOT EXISTS (
    SELECT 1
    FROM tickets t2
    WHERE t2.user_id = t1.user_id
      AND t2.ticket_type = 'BUSINESS'
);
```

---

### ‚úîÔ∏è –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –∑–∞–¥–∞–Ω–∏—è:

|user_id|
|---|
|**500**|
|**750**|

- **500** ‚Äî —Ç–æ–ª—å–∫–æ ECONOMY

- **750** ‚Äî —Ç–æ–ª—å–∫–æ ECONOMY

- **600** ‚Äî –µ—Å—Ç—å –∏ ECONOMY, –∏ BUSINESS ‚Üí –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç

- **800** ‚Äî —Ç–æ–ª—å–∫–æ BUSINESS ‚Üí —Ç–æ–∂–µ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç


---

{{< /details >}}
