#### 100. –ü–æ—Ç–æ–∫–∏, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è AtomicInteger

**–£—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞—á–∏:**  
üìå –î–∞–Ω –∫–æ–¥ —Å –ø–æ—Ç–æ–∫–∞–º–∏. –ù—É–∂–Ω–æ:

1. –°–∫–∞–∑–∞—Ç—å, **—á—Ç–æ –≤—ã–≤–µ–¥–µ—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å** –∏ **–ø–æ—á–µ–º—É**.

2. –ü–æ–∫–∞–∑–∞—Ç—å **–∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Å—á—ë—Ç—á–∏–∫–∞** —Å –ø–æ–º–æ—â—å—é `AtomicInteger`.

3. –ö—Ä–∞—Ç–∫–æ –æ–±—ä—è—Å–Ω–∏—Ç—å, **–≤ —á—ë–º –ø—Ä–æ–±–ª–µ–º–∞ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–¥–∞**.


**–ö–æ–¥:**

```java
public class Question9 {

    public static class TestClass extends Thread {

        private static int threadcounter = 0;

        public void run() {
            ++threadcounter;
            System.out.println(threadcounter);
        }
    }

    public static void main(String[] args) throws Exception {
        for (int i = 0; i < 10; i++) {
            synchronized (TestClass.class) {
                new TestClass().start();
            }
        }
    }
}
```

---

{{< hint warning >}}  
**–°–ø–æ–π–ª–µ—Ä—ã –∫ —Ä–µ—à–µ–Ω–∏—é**  
{{< /hint >}}

---

{{< details "–ü–æ–¥—Å–∫–∞–∑–∫–∏" close >}}  
üí° `synchronized` –≤ `main` **–Ω–µ –∑–∞—â–∏—â–∞–µ—Ç** –∫–æ–¥ –≤–Ω—É—Ç—Ä–∏ `run()`.  
üí° `++threadcounter` ‚Äî **–Ω–µ –∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è**.  
üí° –ü–æ—Ç–æ–∫–∏ —Å—Ç–∞—Ä—Ç—É—é—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω.  
üí° –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å—á—ë—Ç—á–∏–∫–∞ –Ω—É–∂–µ–Ω `AtomicInteger` –∏–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ `run()`.  
{{< /details >}}

---

{{< details "–†–µ—à–µ–Ω–∏–µ" close >}}

### 1Ô∏è‚É£ –ß—Ç–æ –≤—ã–≤–µ–¥–µ—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å?

üëâ **–ë—É–¥—É—Ç –≤—ã–≤–µ–¥–µ–Ω—ã —á–∏—Å–ª–∞ –æ—Ç 1 –¥–æ 10, –Ω–æ:**

- **–ø–æ—Ä—è–¥–æ–∫ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω**,

- **–º–æ–≥—É—Ç –±—ã—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã**,

- **–∫–∞–∫–∏–µ-—Ç–æ —á–∏—Å–ª–∞ –º–æ–≥—É—Ç –ø—Ä–æ–ø–∞—Å—Ç—å**.


–ü—Ä–∏–º–µ—Ä—ã –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞:

```
1
2
3
4
5
6
7
8
9
10
```

–∏–ª–∏

```
1
2
2
3
4
6
6
7
9
9
```

–∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π –≤–∞—Ä–∏–∞–Ω—Ç.

---

### 2Ô∏è‚É£ –ü–æ—á–µ–º—É —Ç–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

#### ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–¥–∞

1. **`synchronized` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ —Ç–∞–º**


```java
synchronized (TestClass.class) {
    new TestClass().start();
}
```

- –ë–ª–æ–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç **—Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –ø–æ—Ç–æ–∫–∞**,

- –Ω–æ **–Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ `run()`**.


2. **`++threadcounter` –Ω–µ –∞—Ç–æ–º–∞—Ä–µ–Ω**


```java
++threadcounter;
```

–ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —ç—Ç–æ —Ç—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏:

1. —á—Ç–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è

2. —É–≤–µ–ª–∏—á–µ–Ω–∏–µ

3. –∑–∞–ø–∏—Å—å


–ï—Å–ª–∏ –¥–≤–∞ –ø–æ—Ç–æ–∫–∞ –≤—ã–ø–æ–ª–Ω—è—é—Ç —ç—Ç–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ ‚Äî –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è (**race condition**).

3. **`static int` –±–µ–∑ –∑–∞—â–∏—Ç—ã**


- –û–±—â–∏–π –¥–ª—è –≤—Å–µ—Ö –ø–æ—Ç–æ–∫–æ–≤.

- –ù–µ—Ç –Ω–∏ `volatile`, –Ω–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.


---

### 3Ô∏è‚É£ –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ AtomicInteger ‚úÖ

#### ‚úîÔ∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Å `AtomicInteger`

```java
import java.util.concurrent.atomic.AtomicInteger;

public class Question9 {

    public static class TestClass extends Thread {

        private static final AtomicInteger threadCounter = new AtomicInteger(0);

        @Override
        public void run() {
            int value = threadCounter.incrementAndGet();
            System.out.println(value);
        }
    }

    public static void main(String[] args) {
        for (int i = 0; i < 10; i++) {
            new TestClass().start();
        }
    }
}
```

#### üîπ –ß—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —ç—Ç–æ—Ç –∫–æ–¥?

- `incrementAndGet()` ‚Äî **–∞—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è**

- –ö–∞–∂–¥–æ–µ —á–∏—Å–ª–æ –æ—Ç **1 –¥–æ 10 –±—É–¥–µ—Ç –≤—ã–≤–µ–¥–µ–Ω–æ —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑**

- –ü–æ—Ä—è–¥–æ–∫ –≤—Å—ë –µ—â—ë –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤)


---

### 4Ô∏è‚É£ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (—á–µ—Ä–µ–∑ synchronized)

```java
public void run() {
    synchronized (TestClass.class) {
        ++threadcounter;
        System.out.println(threadcounter);
    }
}
```

‚úîÔ∏è –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ,  
‚ùå –ù–æ —Ö—É–∂–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è, —á–µ–º `AtomicInteger`.

---

### üß† –ö–æ—Ä–æ—Ç–∫–æ, –∫–∞–∫ —Å–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–æ–±–µ—Å–µ

> `synchronized` –≤ main –Ω–µ –∑–∞—â–∏—â–∞–µ—Ç `run()`.  
> –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç `int` –Ω–µ –∞—Ç–æ–º–∞—Ä–µ–Ω, –ø–æ—ç—Ç–æ–º—É –≤–æ–∑–º–æ–∂–Ω—ã –≥–æ–Ω–∫–∏.  
> –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ ‚Äî `AtomicInteger.incrementAndGet()` –∏–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤–Ω—É—Ç—Ä–∏ `run()`.

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –º–æ–≥—É —É–∂–∞—Ç—å –æ—Ç–≤–µ—Ç –¥–æ **30 —Å–µ–∫—É–Ω–¥ —É—Å—Ç–Ω–æ–≥–æ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è** –∏–ª–∏ —É—Å–ª–æ–∂–Ω–∏—Ç—å –≤–æ–ø—Ä–æ—Å (volatile vs atomic, happens-before).

{{< /details >}}