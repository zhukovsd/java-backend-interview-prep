#### 51. –ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å –ø–æ –∫–∞–∂–¥–æ–º—É col2

üî• –ï—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ table1. –í –Ω–µ–π 4 –∫–æ–ª–æ–Ω–∫–∏. col1 —ç—Ç–æ –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á. col2 —ç—Ç–æ secondary_id (–ª–∏–±–æ foreign key, –º—ã –∑–Ω–∞–µ–º, —á—Ç–æ –æ–Ω —Å–≤—è–∑–∞–Ω —Å –¥—Ä—É–≥–æ–π —Ç–∞–±–ª–∏—Ü–µ–π –∏ –Ω–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –≤ —ç—Ç–æ–π —Ç–∞–±–ª–∏—Ü–µ). col3 —ç—Ç–æ amount (–¥–µ–Ω–µ–∂–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ). col4 —ç—Ç–æ —Å–∏—Å—Ç–µ–º–Ω–æ–µ –ø–æ–ª–µ date (change date, –∫–æ–≥–¥–∞ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å). –ù–∞–ø–∏—Å–∞—Ç—å SELECT –∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–Ω–æ–≥–æ col2 –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫—É, —É –∫–æ—Ç–æ—Ä–æ–π —Å–∞–º–∞—è –ø–æ—Å–ª–µ–¥–Ω—è—è —Å–≤–µ–∂–∞—è date

```text
table1
col1 pk
col2 sec_fk
col3 amount
col4 date
```

---

{{< hint warning >}}  
**–°–ø–æ–π–ª–µ—Ä—ã –∫ —Ä–µ—à–µ–Ω–∏—é**  
{{< /hint >}}

{{< details "–ü–æ–¥—Å–∫–∞–∑–∫–∏" close >}}  
üí° –£–¥–æ–±–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–∫–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `ROW_NUMBER()` —Å —Ä–∞–∑–±–∏–µ–Ω–∏–µ–º –ø–æ `col2` –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ `col4 DESC`.  
üí° –í PostgreSQL –µ—Å—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç —Å `DISTINCT ON (col2)` –∏ `ORDER BY col2, col4 DESC`.  
üí° –î–æ–±–∞–≤—å—Ç–µ –∏–Ω–¥–µ–∫—Å –Ω–∞ `(col2, col4 DESC)` –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è.  
{{< /details >}}

{{< details "–†–µ—à–µ–Ω–∏–µ" close >}}  
–í–∞—Ä–∏–∞–Ω—Ç 1 (ANSI SQL, —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π, —á–µ—Ä–µ–∑ –æ–∫–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é):

```sql
SELECT col1, col2, col3, col4
FROM (
  SELECT
    t.*,
    ROW_NUMBER() OVER (PARTITION BY col2 ORDER BY col4 DESC) AS rn
  FROM table1 t
) s
WHERE s.rn = 1
ORDER BY col2;
```

–í–∞—Ä–∏–∞–Ω—Ç 2 (PostgreSQL, `DISTINCT ON`):

```sql
SELECT DISTINCT ON (t.col2)
  t.col1, t.col2, t.col3, t.col4
FROM table1 t
ORDER BY t.col2, t.col4 DESC;
```

{{< /details >}}