#### 69. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Å–∞ —Å –∏—Å—Ç–µ–∫–∞—é—â–∏–º–∏ –∫–ª—é—á–∞–º–∏

üî• –ù–∞–ø–∏—Å–∞—Ç—å –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–∞—Ä—ã –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ, –≥–¥–µ –∫–∞–∂–¥–æ–º—É –∫–ª—é—á—É –∞—Å—Å–æ—Ü–∏–∏—Ä–æ–≤–∞–Ω–æ –≤—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è. –ü–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è —ç—Ç–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –∫–ª—é—á –¥–æ–ª–∂–µ–Ω —Å—Ç–∞—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º.

**–ú–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞:**

1. `set(String key, String value, int duration)`

    - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–ª—é—á –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏, –∑–Ω–∞—á–µ–Ω–∏–µ —Ç–∏–ø–∞ `String` –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö.

    - –ö–ª—é—á —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è —É–∫–∞–∑–∞–Ω–Ω–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

    - –ú–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `true`, –µ—Å–ª–∏ —Ç–∞–∫–æ–π –∂–µ –∫–ª—é—á, –∫–æ—Ç–æ—Ä—ã–π –µ—â—ë –Ω–µ –∏—Å—Ç–µ–∫, —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∏ `false` –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ.

    - –ó–Ω–∞—á–µ–Ω–∏–µ –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã, –µ—Å–ª–∏ –∫–ª—é—á —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.

2. `get(String key)`

    - –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ–∏—Å—Ç–µ–∫—à–∏–π –∫–ª—é—á, –º–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–≤—è–∑–∞–Ω–Ω–æ–µ —Å –Ω–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ.

    - –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –º–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `-1`.

3. `count()`

    - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–π, —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ –∏—Å—Ç–µ–∫.


---

{{< hint warning >}}  
**–°–ø–æ–π–ª–µ—Ä—ã –∫ —Ä–µ—à–µ–Ω–∏—é**  
{{< /hint >}}

{{< details "–ü–æ–¥—Å–∫–∞–∑–∫–∏" close >}}  
üí° –£–¥–æ–±–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–µ, –Ω–æ –∏ –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è ‚Äî –ª—É—á—à–µ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –∫–ª–∞—Å—Å–µ.  
üí° –î–ª—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ConcurrentHashMap`.  
üí° –ü—Ä–æ–≤–µ—Ä–∫—É –∏—Å—Ç–µ—á–µ–Ω–∏—è (`isExpired`) –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º `get` –∏ `count`.  
üí° –ü—Ä–∏ `count()` –º–æ–∂–Ω–æ —á–∏—Å—Ç–∏—Ç—å –∫–∞—Ä—Ç—É –æ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∫–ª—é—á–µ–π.  
{{< /details >}}

{{< details "–†–µ—à–µ–Ω–∏–µ" close >}}

```java
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

public class ExpiringMap {
    private static class ValueWithExpiry {
        String value;
        long expiryTime;

        ValueWithExpiry(String value, long duration) {
            this.value = value;
            this.expiryTime = System.currentTimeMillis() + duration;
        }

        boolean isExpired() {
            return System.currentTimeMillis() > expiryTime;
        }
    }

    private final Map<String, ValueWithExpiry> storage = new ConcurrentHashMap<>();

    public boolean set(String key, String value, int duration) {
        ValueWithExpiry existing = storage.get(key);
        boolean existedAndNotExpired = existing != null && !existing.isExpired();
        storage.put(key, new ValueWithExpiry(value, duration));
        return existedAndNotExpired;
    }

    public String get(String key) {
        ValueWithExpiry v = storage.get(key);
        if (v == null || v.isExpired()) {
            storage.remove(key);
            return "-1";
        }
        return v.value;
    }

    public int count() {
        storage.entrySet().removeIf(entry -> entry.getValue().isExpired());
        return storage.size();
    }
}
```

{{< /details >}}