#### 53. –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–µ–π –∏–∑ —Ç–∞–±–ª–∏—Ü—ã emails

**–£—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞—á–∏:**  
üìå –í —Ç–∞–±–ª–∏—Ü–µ `emails(id, email)` –º–æ–≥—É—Ç –≤—Å—Ç—Ä–µ—á–∞—Ç—å—Å—è **–¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è email-–∞–¥—Ä–µ—Å–∞**.  
–ù—É–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å SQL-–∑–∞–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π —É–¥–∞–ª—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ **–æ–¥–Ω—É –∑–∞–ø–∏—Å—å** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ email.

**–ö–æ–¥:**

```sql
CREATE TABLE emails (
    id INT,
    email VARCHAR(30)
);

INSERT INTO emails(id, email)
VALUES
(1, 'aa@yandex.ru'),
(2, 'bb@yandex.ru'),
(3, 'aa@yandex.ru');
```

{{< hint warning >}}  
**–°–ø–æ–π–ª–µ—Ä—ã –∫ —Ä–µ—à–µ–Ω–∏—é**  
{{< /hint >}}

{{< details "–ü–æ–¥—Å–∫–∞–∑–∫–∏" close >}}  
üí° –ß—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏, —Å–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–∞—è –∑–∞–ø–∏—Å—å —Å—á–∏—Ç–∞–µ—Ç—Å—è "—É–Ω–∏–∫–∞–ª—å–Ω–æ–π" ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å **–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º id**.  
üí° –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **CTE** —Å `ROW_NUMBER()` –∏–ª–∏ –ø–æ–¥–∑–∞–ø—Ä–æ—Å —Å `MIN(id)`.  
üí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É–¥–∞–ª—è–µ—Ç–µ —Ç–æ–ª—å–∫–æ –¥—É–±–ª–∏, –∞ –Ω–µ –≤—Å–µ —Å—Ç—Ä–æ–∫–∏.  
{{< /details >}}

{{< details "–†–µ—à–µ–Ω–∏–µ" close >}}

```sql
-- ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 1. –ß–µ—Ä–µ–∑ CTE –∏ ROW_NUMBER()
WITH duplicates AS (
    SELECT 
        id,
        ROW_NUMBER() OVER (PARTITION BY email ORDER BY id) AS rn
    FROM emails
)
DELETE FROM emails
WHERE id IN (
    SELECT id FROM duplicates WHERE rn > 1
);
```

```sql
-- ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç 2. –ë–µ–∑ CTE (—á–µ—Ä–µ–∑ –ø–æ–¥–∑–∞–ø—Ä–æ—Å)
DELETE FROM emails
WHERE id NOT IN (
    SELECT MIN(id)
    FROM emails
    GROUP BY email
);
```

> üß† **–ü–æ—è—Å–Ω–µ–Ω–∏–µ:**
>
> - `GROUP BY email` –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∞–¥—Ä–µ—Å–∞.
>
> - `MIN(id)` –æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä (—Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º id).
>
> - –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ —Å —Ç–µ–º –∂–µ email —É–¥–∞–ª—è—é—Ç—Å—è.
>

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Å—Ç–∞–Ω–µ—Ç—Å—è:

|id|email|
|---|---|
|1|[aa@yandex.ru](mailto:aa@yandex.ru)|
|2|[bb@yandex.ru](mailto:bb@yandex.ru)|


{{< /details >}}
