#### 49. –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü ¬´–ü—Ä–æ–¥—É–∫—Ç—ã¬ª –∏ ¬´–ù–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –º–∞–≥–∞–∑–∏–Ω–∞–º¬ª

**–£—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞—á–∏:**  
üìå –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü –¥–ª—è —Å–µ—Ç–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å:
1. –ö–∞–∫–∏–µ —Ç–æ–≤–∞—Ä—ã –µ—Å—Ç—å –≤ —Ç–æ–º –∏–ª–∏ –∏–Ω–æ–º –º–∞–≥–∞–∑–∏–Ω–µ.
2. –í –∫–∞–∫–∏—Ö –º–∞–≥–∞–∑–∏–Ω–∞—Ö –µ—Å—Ç—å —Ç–æ—Ç –∏–ª–∏ –∏–Ω–æ–π —Ç–æ–≤–∞—Ä.
3. –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞ –ø–æ –≤—Å–µ–º –º–∞–≥–∞–∑–∏–Ω–∞–º.
4. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ç–æ–≤–∞—Ä–∞—Ö –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –º–∞–≥–∞–∑–∏–Ω–µ.

**–ö–æ–¥:**

```sql
-- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –º–∞–≥–∞–∑–∏–Ω–æ–≤
CREATE TABLE store (
    id   BIGSERIAL PRIMARY KEY,
    name TEXT       NOT NULL
);

-- –¢–∞–±–ª–∏—Ü–∞ —Ç–æ–≤–∞—Ä–æ–≤
CREATE TABLE product (
    id          BIGSERIAL PRIMARY KEY,
    name        TEXT       NOT NULL,
    sku         TEXT       UNIQUE NOT NULL,  -- –∞—Ä—Ç–∏–∫—É–ª
    description TEXT
);

-- –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –Ω–∞–ª–∏—á–∏—è —Ç–æ–≤–∞—Ä–∞ –≤ –º–∞–≥–∞–∑–∏–Ω–µ
CREATE TABLE store_inventory (
    store_id   BIGINT NOT NULL
        REFERENCES store(id),
    product_id BIGINT NOT NULL
        REFERENCES product(id),
    quantity   INT    NOT NULL CHECK (quantity >= 0),
    PRIMARY KEY (store_id, product_id)
);
````

{{< hint warning >}}  
**–°–ø–æ–π–ª–µ—Ä—ã –∫ —Ä–µ—à–µ–Ω–∏—é**  
{{< /hint >}}

{{< details "–ü–æ–¥—Å–∫–∞–∑–∫–∏" close >}}  
üí° –î–ª—è —Å–≤—è–∑–∏ ¬´–º–Ω–æ–≥–∏–µ‚Äë–∫–æ‚Äë–º–Ω–æ–≥–∏–º¬ª –º–µ–∂–¥—É –º–∞–≥–∞–∑–∏–Ω–∞–º–∏ –∏ —Ç–æ–≤–∞—Ä–∞–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ **junction‚Äë—Ç–∞–±–ª–∏—Ü–∞** `store_inventory`.  
üí° –ü–æ–ª–µ `quantity` —Ö—Ä–∞–Ω–∏—Ç —Ç–µ–∫—É—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ–¥–∏–Ω–∏—Ü —Ç–æ–≤–∞—Ä–∞ –≤ –∫–∞–∂–¥–æ–º –º–∞–≥–∞–∑–∏–Ω–µ (–º–æ–∂–µ—Ç –±—ã—Ç—å 0).  
üí° –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á `(store_id, product_id)` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π.  
üí° –¢–∞–±–ª–∏—Ü–∞ `product` —Å–æ–¥–µ—Ä–∂–∏—Ç `sku` (–∞—Ä—Ç–∏–∫—É–ª) –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –∏ –ø–æ–∏—Å–∫.  
{{< /details >}}

{{< details "–†–µ—à–µ–Ω–∏–µ" close >}}

```sql
-- –ü—Ä–∏–º–µ—Ä –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è:
INSERT INTO store (name) VALUES ('–ù–∞ –æ–ø—É—à–∫–µ'), ('–†–µ—á–Ω–æ–π');

INSERT INTO product (name, sku, description)
VALUES
  ('–•–ª–µ–±', 'BREAD-001', '–ë–∞—Ç–æ–Ω –±–µ–ª—ã–π'),
  ('–ú–æ–ª–æ–∫–æ', 'MILK-001', '2.5% –∂–∏—Ä–Ω–æ—Å—Ç–∏'),
  ('–Ø–±–ª–æ–∫–∏', 'APPLE-001', '–ó–µ–ª–µ–Ω—ã–µ');

-- –£–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –º–∞–≥–∞–∑–∏–Ω–∞—Ö:
INSERT INTO store_inventory (store_id, product_id, quantity)
VALUES
  (1, 1, 50),  -- –≤ –º–∞–≥–∞–∑–∏–Ω–µ 1 ‚Äî 50 —à—Ç—É–∫ –•–ª–µ–±–∞
  (1, 2, 30),  -- –≤ –º–∞–≥–∞–∑–∏–Ω–µ 1 ‚Äî 30 —à—Ç—É–∫ –ú–æ–ª–æ–∫–∞
  (2, 2,  0),  -- –≤ –º–∞–≥–∞–∑–∏–Ω–µ 2 ‚Äî –Ω–µ—Ç –ú–æ–ª–æ–∫–∞
  (2, 3, 20);  -- –≤ –º–∞–≥–∞–∑–∏–Ω–µ 2 ‚Äî 20 —à—Ç—É–∫ –Ø–±–ª–æ–∫

-- 1) –¢–æ–≤–∞—Ä—ã –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –º–∞–≥–∞–∑–∏–Ω–µ:
SELECT p.name, si.quantity
FROM store_inventory si
JOIN product p ON p.id = si.product_id
WHERE si.store_id = 1;

-- 2) –ú–∞–≥–∞–∑–∏–Ω—ã, –≥–¥–µ –µ—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–æ–≤–∞—Ä:
SELECT s.name, si.quantity
FROM store_inventory si
JOIN store s ON s.id = si.store_id
WHERE si.product_id = 2 AND si.quantity > 0;

-- 3) –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ –ø–æ –≤—Å–µ–º –º–∞–≥–∞–∑–∏–Ω–∞–º:
SELECT p.name,
       SUM(si.quantity) AS total_quantity
FROM product p
LEFT JOIN store_inventory si ON si.product_id = p.id
GROUP BY p.name;

-- 4) –°–ø–∏—Å–æ–∫ –º–∞–≥–∞–∑–∏–Ω–æ–≤, –≥–¥–µ —Ç–æ–≤–∞—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:
SELECT s.name
FROM store s
LEFT JOIN store_inventory si
  ON si.store_id = s.id AND si.product_id = 2
WHERE COALESCE(si.quantity, 0) = 0;
```

{{< /details >}}