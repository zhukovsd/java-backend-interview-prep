+++
title = 'Вопросы на подумать'
weight = 3
bookFlatSection = true
bookToC = false
+++

# Вопросы на подумать

---
 1. Ситуация. SQL. На счету пользователя 1000 р. Первая транзакция: читает 1000 на счету, пытается снять 1000. Вторая транзакция тоже читает 1000, хочет снять еще 500 р. По результату уходим в минус. Как обойти ситуацию? -Если хотим решить ситуацию, но оставить уровень транзакции READ COMMITED?

 2. Ситуация. SQL. На уровне Repeatable Read или Serializable транзакция начинает обновлять запись, но сама транзакция еще не завершается. Могут ли две транзакции друг друга заблокировать? Как называется, как с ней быть? - deadlock

 3. Ситуация. Индексы. По бизнес-логике нужно часто делать запросы по точному совпадению фамилии доставать пользователей. Ты хочешь повесить индекс на это поле для повышения перформанса. Какой тип индекса лучше подойдет? - А хеш-индекс подойдет? - Если поле не фамилия, а номер счета, но не primary key? - Если поле updated_at timestamp, хочу посмотреть все данные, которые были обновлены за последний час, либо за вчерашний день,  какой индекс лучше подойдет? - BTree, потому что отсортированное дерево

 4. Ситуауция. SQL. Таблица уже в проде, приложение тоже, очень много данных, почти ТБайты, активное использование. Как повесить индексы на таблицу, но не блокировать доступ к таблице, не останавливать прод?

 5. Ситуция. SQL. Как резделять данные по шардам, если есть 4 инстанса, мы берем данные из uuid. А потом захотим добавить 5 инстанс, придется переложить заново? - Альтернатива координатору для распределения по шардам (если координатор упадет, потеряем данные ко всему)

 6. Ситуация. SQL. Сервис в рамках транзакции сохранил в БД и должен еще записать в Kafka, но отключили свет. Как предусмотреть, что в БД закомичены данные, которые не дошли до конца?

 7. Ситуация. Общаемся с сервисом по REST, получили сетевую ошибку, кажется, что можно вызывать заново. Что настроить на своей стороне? - паттерн Retry - Если соседний сервис очень слабый, то постоянный retry еще больше его положит - увеличить промежутки времени между retry или паттерн circuit breaker

 8. Ситуация. Со стороны consumer-а. Топик очень высоконагруженый. 8 партиций. Хотим масшрабироваться на стороне consumer-а, читать сообщения побыстрее. Какой способ? Чтобы читать сообщения с одной бизнес-логикой несколькими Spring-приложениями

 9. Ситуация. Сервис закупок хранит количества остатка товара на складе.  Пользователь выбирает товары в приложении и видит, сколько товаров осталось. Этот сервис проскалирован и используется кеширование для количества остатка товара. Какой кеш лучше локальный или распределенный? - Если сделаем локально, будут ли проблемы? - С другой стороне, если товар в одном экземпляре, у каждого клиента это записано. Что может случиться?

 10. Ситуация. Стратегии деплоя. Сервис работает в проде, новый релиз с серьезным багом.  Если такой релиз выкатим, а предыдущий убьем, будет больно. Какие более плавные подходы деплоя?

 11. Ситуация. Деплой. У тебя был монолит, билдился 40 минут.  Если надо раскатить предыдущую версию, придется ждать 40 минут. Есть ли менее болезненные подходы? 

 12. Ситуация. Код в try возвращает разный int. В catch обрабатываем ошибку и  оборачиваем в свою. В finally возвращаем 0.  В какой последовательности все пойдет? Что получим на выходе метода?

 13. Ситуация. 2 таблицы: данные сотрудника и отделы.  Хотим получить данные сотрудника и название отдела. Какой JOIN использовать?

 14. Ситуация. Liquibase. Если не знаем, какая БД в проде. Боимся, что что-то произойдет при накатке. Хотим сделать себе возможность откатить изменения 

 15. Ситуауция: есть Spring Boot Application, он собрался. Запускаешь получившийся jar-ник. Он падает с Runtime Exception - не может внедрить зависимости: 2 кандидата на внедрение в какое-то место. Из-за чего такое может произойти? Как решить?

 16. Ситуация. Есть класс-сервис. Внутри 2 метода. Оба public, @Transactional. Первый метод внутри обращается ко второму. Инжектим класс из другого класса и обращаемся к первому методу. Будет ли второй метод транзакционным? После. бираем транзакцию у первого метода.  Делаем такое же обращение через первый метод.  Через 10 минут демо, надо, чтобы второй метод стал транзакционным

 17. Ситуация. Можем ли мы создать несколько синглтонов, которые будут имплемитировать один и тот же класс, но будут разные параметры?

 18. Ситуация. Kafka. 3 машины в кафке и одна упала. Что с нашей инфой? Инфа постарадает?

 19. Ситуация. Kafka. Было 2 сервиса (producer, consumer), общались по Kafka. Consumer на каждое сообщение должен проходить большой процесс обогащения, поэтому стали копиться сообщения. Решили в двух pod-ах поднять consumer. Но второй pod не видит сообщений. В чем проблема?

 20. Ситуация. Kafka. Если у нас несколько брокеров как будут распологаться partition?

 21. Ситуация. Kafka. У нас есть n partition. Есть ли смысл настроить Spring приложение для увеличения partition?

 22. Ситуация. Kafka. Consumer group. 10 партиций и консьюмеры не справляются. Что делать?

 23. Ситуация. Docker. Один контейнер содержит app, который умеет убивать ОС. Выживут ли другие контейнеры?

 24. Ситуация. Liquibase. Две ветки от master, в одной изменения внесены в бд с liquibase. Ты её локально поднимаешь - ок. Начинаешь поднимать 2 ветку, в ней тоже есть изменения бд через  liquibase. Когда будешь поднимать 2 ветку, возникнут какие либо проблемы? (Check сумма не будет совпадать  liquibase кинет exception)

 25. Ситуация. HashMap расширилась. Добавили в неё 13 элементов, потом удалили 2 что произойдет?

 26. Ситуация. У класса есть статический атрибут (public static int counter). Мы его инкрементим. Операцию инкремента отдаем 100 потокам. Будет ли в итоге counter равен 100?

 27. Ситуация. Подключаю Spring Boot Application, делаю Maven parent SpringBoot и подключаю SpringBootStarter. Веб появляется?

 28. Ситуация. Метод помечен @Transactional, в нем обращаемся к БД, получаем сущность, на этой же сущности ставим set_id. И забываем сделать сохранение в БД. Что происходит?

 29. Ситуация. В HashMap вставляем 10 тыс ключ-значений, это все разные объекты. Как сделать так, что с вероятностью 99% мы получили значение по ключу за константное время? - один вариант: сразу создать очень большую мапу 10 млрд значений

 30. Ситуация. Есть веб-сервис на Tomcat, Spring Boot. Ты написал Controller получения имени пользователя по id. За именем пользователя идешь в БД Postgres. Запускаешь этот сервис на одноядерной системе, ожидаешь нагрузку около 100 запросов в секунду. Будет ли это работать?

 31. Ситуация. На тех же мощностях запускаем сервер, но ручка вычисляет числа Фибоначчи. Что-то изменится? - Как это будет выглядеть со стороны метрик?  - Со стороны пользователей это будет выглядеть так, что запрос очень долго выполняется? Что будет с CPU? На сколько он будет нагружен?

 32. Ситуация. Переменную count хочешь быстро заинкрементировать до 10 тыс. В цикле запустил 10 тыс. потоков, которые инкрементят счетчик. Решил сделать синхронизацию. Какой способ выбрать: synchronized или atomic? Почему?

 33. Ситуация. Как сделать так, если 10 потоков вызывают get() одновременно, ты не создал 10 объектов Singletone?

 34. Ситуация. От стартеров абстрагируемся. Хотим сделать Spring Boot приложение. Ставим @SpringBootApplication public static void main. Передаешь класс, где main. Добавляешь зависимости, стартеры и все начинает работать. От момента, как прописал зависимости и поставил аннотацию - что происходит? - Что значит идет конфигурирование приложения?

 35. Ситуация. Что делает Spring Boot? В Maven в pom-ник добавляешь зависимость dependencies пишешь либы org, spring, springwebstarter. Прописал и начинаешь релоадить. Что происходит в этот момент? - Что значит подгружаются зависимости?  - Куда попадают библиотеки, классы?  - Для чего Spring Boot кладет библиотеки в локальную папку? - Что такое Classpath?

 36. Ситуация. Какие коллекции позволяют дублировать, какие не позволяют?

 37. Ситуация. Kafka. Есть producer, consumer, consumer record. Consumer record несет в себе key-value. Есть топик, в нем 3 партиции. Мы продьюсим сообщения. Вкакую патртицию попадают сообщения? По каким принципам?

 38. Ситуация. Kafka. Топик и 3 партиции. Мы создаем одного consumer-a. К каким партициям прицепится consumer? - цепляется ко всем 3 партициям. Создаем еще одного consumera. С такой же group id. И цепляем его к такому же топику. Он тоже подцепится к этим трем партициям? - Kafka ребалансируется, один консьюмер получит 2 партиции, а второй консьюмер получит 1 партицию

 39. Ситуация. БД. Предположим, разработали микросервис на спринге и есть бизнес-логика по забору данных, есть "тонкое место". Что делать будем, как решать проблему?

 40. Ситуация. Переменная не помечена словом final, но изменяться она не может?

 41. В чем отличие несинхронной обработки запроса и неблокирующей реактивной обработки?

 42. Хорошо ли делать длинную цепочку наследования на классах? 

 43. Как поведёт себя запущенный проект на Spring без spring-boot-starter-web?

 44. Библиотека vs фреймворк

 45. Ситуация. Есть таблица, 2 поля: айди и количество лайков. Как бы ты сделал увеличение счетчиков лайков на 1?

 46. Ситуация. Есть класс, у которого 2 поля int и java.util.date. Как сделать immutable class из этого?

 47. Ситуация. Есть класс, в котором должны быть заинжекчены какие-то бины. В чем разница сделать это через поля класса, либо через конструктор?

 48. Ситуация. Есть таблицы: Authors(id int PK, name text), Books(id int PK, title text). Как сделать на уровне БД так, чтобы у авторов могло быть много книг, и у книги много авторов? - сделать третью таблицу и связь многие-ко-многим
  
 49. Ситуация Kafka. Есть 5 консьюмеров. Хотим ими параллельно читать из Kafka, чтобы каждому доставались уникальные сообщения. Можно ли такого достичь?

 50. Ситуация. Как назвать метод. Есть таблица users, поле age. Как назовешь метод, если нужно найти всех users с определенным age и отсортировать по возрастанию

 51. Ситуация. Kafka. Есть два сервиса, им нужно общаться между собой. Два топика. Что должно быть реализовано на сервисах?

 52. Ситуация по volatile. Может ли быть, что разные потоки всегда видят актуальное значение переменной, хотя она НЕ помечена volatile?

 53. Ситуация по synchronized. Есть статичный метод, в его сигнатуре пишу synchronized. На чем будет происходить синхронизация?
    
