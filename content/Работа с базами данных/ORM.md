+++
title = 'ORM'
weight = 4
bookFlatSection = true
+++

## ORM

#### 1. –ß—Ç–æ —Ç–∞–∫–æ–µ Hibernate, JPA, JDBC, ORM?
*Hibernate* - —ç—Ç–æ ORM Framework (–æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö JPA —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π) 

*JPA* - —ç—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è Java, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∞–±–æ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤/–∞–Ω–Ω–æ—Ç–∞—Ü–∏–π

*ORM* - –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –≤ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—É—é –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç

*JDBC* - –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π API –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö. 

---
#### 2. –ü–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã ORM
**–ü–ª—é—Å—ã:**
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –±–∏–∑–Ω–µ—Å –º–µ—Ç–æ–¥–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è –Ω–µ –∫ –ë–î, –∞ –∫ Java –∫–ª–∞—Å—Å–∞–º
- –£—Å–∫–æ—Ä—è–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ JDBC
- –°—É—â–Ω–æ—Å—Ç–∏ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –±–∏–∑–Ω–µ—Å-–∑–∞–¥–∞—á–∞—Ö, –∞ –Ω–µ –Ω–∞ —Å—Ç—Ä—É–∫—Ä—É—Ä–µ –ë–î
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

**–ú–∏–Ω—É—Å—ã:**
- **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–Ω–µ–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π, —á–µ–º —Ä—É—á–Ω–æ–µ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤.
- **–°–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** ‚Äî ORM –ø–ª–æ—Ö–æ —Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω—ã–º–∏ SQL-–∑–∞–ø—Ä–æ—Å–∞–º–∏, —Ç–∞–∫–∏–º–∏ –∫–∞–∫ —Å–ª–æ–∂–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–ª–∏ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ JOIN'—ã.

---
#### 3. –ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å Entity –∏ —á—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?
–≠—Ç–æ –∫–ª–∞—Å—Å, –ø–æ–º–µ—á–µ–Ω–Ω—ã–π –∞–Ω–Ω–æ—Ç–∞—Ü–∏–µ–π `@Entity`, –Ω—É–∂–µ–Ω –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ Java –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –ë–î –æ–±—ä–µ–∫—Ç—ã –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç. –û–Ω–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–º —É—Å–ª–æ–≤–∏—è–º–∏:

- –î–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—É—Å—Ç–æ–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
- –ù–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–º, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º, ENUM, –∏–ª–∏ final
- –ù–µ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å final –ø–æ–ª–µ–π
- –•–æ—Ç—è –±—ã –æ–¥–Ω–æ –ø–æ–ª–µ –ø–æ–º–µ—á–µ–Ω–Ω–æ–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–µ–π `@Id `
- –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è `@Entity` –Ω–∞–¥ –∫–ª–∞—Å—Å–æ–º
- –î–æ–ª–∂–µ–Ω –±—ã—Ç—å `POJO` (–≤—Å–µ –ø–æ–ª—è private + getter-—ã –∏ setter-s –∫ –Ω–∏–º)

---
#### 4. –ú–æ–∂–µ—Ç –ª–∏ Entity –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç –Ω–µ-Entity –∫–ª–∞—Å—Å–æ–≤?
–î–∞. –ú–æ–∂–µ—Ç

---
#### 5. –ú–æ–∂–µ—Ç –ª–∏ Entity –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç –¥—Ä—É–≥–∏—Ö Entity –∫–ª–∞—Å—Å–æ–≤?
–î–∞. –ú–æ–∂–µ—Ç

---
#### 6. –ü–æ—á–µ–º—É –º—ã –Ω–µ –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å final –∫–ª–∞—Å—Å—ã –≤ –∫–∞—á–µ—Å—Ç–≤–µ Entity?
–ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ Entity –≤ final –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å Hibernate –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏, —á—Ç–æ –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å, –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç Hibernate –ø—Ä–∏–º–µ–Ω—è—Ç—å –ª–µ–Ω–∏–≤—É—é –∑–∞–≥—Ä—É–∑–∫—É. –ü–æ—Ç–æ–º—É —á—Ç–æ, –ø—Ä–æ–∫—Å–∏-–∫–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç –∫–ª–∞—Å—Å–∞-—Å—É—â–Ω–æ—Å—Ç–∏, —á—Ç–æ–±—ã –∑–∞–º–µ–Ω–∏—Ç—å –µ–≥–æ –Ω–∞—Å—Ç–æ—è—â–∏–º –æ–±—ä–µ–∫—Ç–æ–º –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –Ω–æ —Ç.–∫ final –∑–∞–ø—Ä–µ—â–∞–µ—Ç –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –æ—Ç –∫–ª–∞—Å—Å–æ–≤ - –º—ã —ç—Ç–æ–≥–æ —Å–¥–µ–ª–∞—Ç—å –Ω–µ –º–æ–∂–µ–º

---
#### 7. –ß—Ç–æ —Ç–∞–∫–æ–µ Proxy –∏ –¥–ª—è —á–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è?
**Hibernate Proxy** ‚Äî —ç—Ç–æ –æ–±—ä–µ–∫—Ç-–∑–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å (placeholder) –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è "–ª–µ–Ω–∏–≤–æ" (lazy loading). –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ Hibernate —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–∫—Å–∏-–æ–±—ä–µ–∫—Ç –≤–º–µ—Å—Ç–æ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∏ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–æ—Å—Ç—É–ø–µ –∫ –Ω–∏–º. –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∑–∞–≥—Ä—É–∂–∞—è –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –æ–Ω–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω—ã.

---
***–í –∫–∞–∫–æ–π –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è Proxy?***

Proxy –≤ Hibernate —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –º—ã –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –æ–±—ä–µ–∫—Ç –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –Ω–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –¥–∞–Ω–Ω—ã–µ —ç—Ç–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è (–ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞, **lazy loading**). –í–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—Ä–æ–∫—Å–∏-–æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –ø–æ–¥—Å—Ç–∞–≤–Ω—ã–º –æ–±—ä–µ–∫—Ç–æ–º, —Å–æ–∑–¥–∞–Ω–Ω—ã–º –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

- **–ú–µ—Ö–∞–Ω–∏–∑–º**: Hibernate —Å–æ–∑–¥–∞—ë—Ç –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º–æ–≥–æ –∫–ª–∞—Å—Å–∞ –∏–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –º–µ—Ç–æ–¥—ã, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏—Ö –≤—ã–∑–æ–≤–µ.

```java
Session session = sessionFactory.openSession();
User user = session.get(User.class, 1); // –ü–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç
User lazyUser = session.load(User.class, 2); // Proxy-–æ–±—ä–µ–∫—Ç

```

- –í —Å–ª—É—á–∞–µ `session.get()` –æ–±—ä–µ–∫—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É.
    
- –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `session.load()` –æ–±—ä–µ–∫—Ç –∑–∞–º–µ–Ω—è–µ—Ç—Å—è Proxy –¥–æ –º–æ–º–µ–Ω—Ç–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –¥–∞–Ω–Ω—ã–º.

---
***–ö–∞–∫ —Å–æ–∑–¥–∞–µ—Ç—Å—è Proxy***

 **1Ô∏è‚É£ Proxy –≤ Hibernate**

 **üîπ –ö–∞–∫ Hibernate —Å–æ–∑–¥–∞–µ—Ç Proxy?**

–ö–æ–≥–¥–∞ —Å—É—â–Ω–æ—Å—Ç—å –∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω–∞ `@OneToMany`, `@ManyToOne`, `@OneToOne` –∏–ª–∏ `@ManyToMany` —Å `fetch = FetchType.LAZY`, Hibernate **–ø–æ–¥–º–µ–Ω—è–µ—Ç –æ–±—ä–µ–∫—Ç –Ω–∞ –ø—Ä–æ–∫—Å–∏-–∫–ª–∞—Å—Å** (–ø–æ–¥–∫–ª–∞—Å—Å —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞).

üìå **–ü—Ä–∏–º–µ—Ä:**

```java
@Entity
class User {
    @Id @GeneratedValue
    private Long id;
    private String name;

    @OneToMany(mappedBy = "user", fetch = FetchType.LAZY)
    private List<Order> orders;
}

@Entity
class Order {
    @Id @GeneratedValue
    private Long id;
    private String product;

    @ManyToOne
    @JoinColumn(name = "user_id")
    private User user;
}
```

üí° **Hibernate —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–∫—Å–∏ –¥–ª—è `orders`, –∑–∞–≥—Ä—É–∂–∞—è –∏—Ö —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–æ—Å—Ç—É–ø–µ.**

üìå **–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø—Ä–æ–∫—Å–∏ —ç—Ç–æ –∏–ª–∏ –Ω–µ—Ç?**

```java
Session session = sessionFactory.openSession();
User user = session.get(User.class, 1L);

System.out.println(user.getOrders().getClass()); 
// class com.sun.proxy.$Proxy...
```


 **üîπ –ü—Ä–æ–±–ª–µ–º—ã —Å Proxy –≤ Hibernate**

‚ùå **LazyInitializationException**

```java
Session session = sessionFactory.openSession();
User user = session.get(User.class, 1L);
session.close();

user.getOrders().size(); // –û—à–∏–±–∫–∞! –î–æ—Å—Ç—É–ø –∫ Proxy –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏
```

üìå **–†–µ—à–µ–Ω–∏–µ:**

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **`JOIN FETCH`**
- –û—Ç–∫—Ä—ã—Ç—å —Å–µ—Å—Å–∏—é –≤—Ä—É—á–Ω—É—é (**OpenSessionInView**)

üìå **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `JOIN FETCH`:**

```java
List<User> users = session.createQuery(
    "SELECT u FROM User u JOIN FETCH u.orders", User.class
).getResultList();
```


 **2Ô∏è‚É£ Proxy –≤ Spring**

–í Spring **–ø—Ä–æ–∫—Å–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è AOP (Aspect-Oriented Programming)**, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (`@Transactional`), security (`@PreAuthorize`) –∏ –¥—Ä—É–≥–∏—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤.


 **üîπ –ö–∞–∫ Spring —Å–æ–∑–¥–∞–µ—Ç Proxy?**

 **üîπ JDK Dynamic Proxy (—á–µ—Ä–µ–∑ `Proxy.newProxyInstance()`)**

- –†–∞–±–æ—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏**.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

üìå **–ü—Ä–∏–º–µ—Ä:**

```java
@Service
public class MyServiceImpl implements MyService {
    public void doSomething() {
        System.out.println("–†–∞–±–æ—Ç–∞ –º–µ—Ç–æ–¥–∞");
    }
}
```

Spring —Å–æ–∑–¥–∞–µ—Ç **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–∫—Å–∏**:

```java
MyService proxy = (MyService) Proxy.newProxyInstance(
    MyServiceImpl.class.getClassLoader(),
    new Class[]{MyService.class},
    new InvocationHandler() { /* –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–∑–æ–≤–æ–≤ */ }
);
```

 **üîπ CGLIB Proxy (—á–µ—Ä–µ–∑ `Enhancer.create()`)**

- –†–∞–±–æ—Ç–∞–µ—Ç —Å **–æ–±—ã—á–Ω—ã–º–∏ –∫–ª–∞—Å—Å–∞–º–∏ (–±–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤)**.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ **–Ω–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞**.

üìå **–ü—Ä–∏–º–µ—Ä:**

```java
@Service
public class MyService {
    public void doSomething() {
        System.out.println("–†–∞–±–æ—Ç–∞ –º–µ—Ç–æ–¥–∞");
    }
}
```

Spring —Å–æ–∑–¥–∞–µ—Ç **CGLIB-–ø—Ä–æ–∫—Å–∏**:

```java
MyService proxy = (MyService) Enhancer.create(
    MyService.class, 
    new MethodInterceptor() { /* –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–∑–æ–≤–æ–≤ */ }
);
```

 **üîπ Proxy –≤ `@Transactional`**

Spring –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–∫—Å–∏ –¥–ª—è –±–∏–Ω–æ–≤ —Å `@Transactional`, —á—Ç–æ–±—ã **–ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –≤—ã–∑–æ–≤—ã –º–µ—Ç–æ–¥–æ–≤ –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏**.

üìå **–ü—Ä–∏–º–µ—Ä:**

```java
@Service
public class PaymentService {
    @Transactional
    public void processPayment() {
        System.out.println("–û–ø–ª–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞");
    }
}
```

üìå **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ–∫—Å–∏?**

1. –ï—Å–ª–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–µ—Ç–æ–¥ `processPayment()`, Spring —Å–æ–∑–¥–∞–µ—Ç **–ø—Ä–æ–∫—Å–∏-–æ–±—ä–µ–∫—Ç**.
2. –ü—Ä–æ–∫—Å–∏ **–ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–∑–æ–≤** –∏ **–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é**.
3. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `processPayment()`.
4. –ü—Ä–æ–∫—Å–∏ **—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∏–ª–∏ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç** —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.

‚ùå **–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ –ù–ï —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–∫—Å–∏!**

```java
@Transactional
public void outerMethod() {
    innerMethod(); // ‚ùå –ù–ï –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ–∫—Å–∏
}
@Transactional
public void innerMethod() {
    // –ó–¥–µ—Å—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ —Å–æ–∑–¥–∞—Å—Ç—Å—è
}
```

üìå **–†–µ—à–µ–Ω–∏–µ:** –í—ã–∑–≤–∞—Ç—å —á–µ—Ä–µ–∑ `self`:

```java
@Autowired
private PaymentService self;

public void outerMethod() {
    self.innerMethod(); // ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏
}
```

 **üìå –ò—Ç–æ–≥**

‚úÖ **Hibernate Proxy** ‚Äì –ª–µ–Ω–∏–≤–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (`Lazy Loading`).  
‚úÖ **Spring Proxy** ‚Äì —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏, AOP –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é.  
‚úÖ **JDK Proxy** ‚Äì —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏.  
‚úÖ **CGLIB Proxy** ‚Äì —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–ª–∞—Å—Å–∞–º–∏ –±–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤.

---
***–í–∏–¥—ã –ø—Ä–æ–∫—Å–∏***

 1. **–ü—Ä–æ–∫—Å–∏ –¥–ª—è —Å—É—â–Ω–æ—Å—Ç–µ–π (Entity Proxy)**

- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–æ–∫—Å–∏-—Å—É—â–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ª–µ–Ω–∏–≤–æ (lazy loading). –≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–∏–ø –ø—Ä–æ–∫—Å–∏, –∫–æ—Ç–æ—Ä—ã–π Hibernate —Å–æ–∑–¥–∞—ë—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞, –µ—Å–ª–∏ –µ–≥–æ –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏.
    
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**: –ü—Ä–æ–∫—Å–∏-—Å—É—â–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –º–µ—Ç–æ–¥–∞ `session.load()` (–∏–ª–∏ –∫–æ–≥–¥–∞ —É–∫–∞–∑–∞–Ω–æ `fetch = FetchType.LAZY` –¥–ª—è –ø–æ–ª–µ–π —Å—É—â–Ω–æ—Å—Ç–∏).

```java
@Entity
public class User {
    @Id
    private Long id;
    
    private String name;
    
    // –õ–µ–Ω–∏–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–≤—è–∑–∞–Ω–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏
    @ManyToOne(fetch = FetchType.LAZY)
    private Address address;
}

```
–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ:
```java
User user = session.load(User.class, 1L);  // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–∫—Å–∏, –∞ –Ω–µ —Ä–µ–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç

```

–ü—Ä–æ–∫—Å–∏-—Å—É—â–Ω–æ—Å—Ç—å –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –¥–æ—Å—Ç—É–ø–µ –∫ –ø–æ–ª—è–º –æ–±—ä–µ–∫—Ç–∞, —Ç–∞–∫–∏–º –∫–∞–∫ `user.getName()`.


 2. **–ü—Ä–æ–∫—Å–∏ –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–π (Collection Proxy)**

- **–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–æ–∫—Å–∏ –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∞—Å—Å–æ—Ü–∏–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π –æ–±—ä–µ–∫—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ø–∏—Å–∫–æ–≤ –∏–ª–∏ –Ω–∞–±–æ—Ä–æ–≤). –ï—Å–ª–∏ –∫–æ–ª–ª–µ–∫—Ü–∏—è –∏–º–µ–µ—Ç –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é `fetch = FetchType.LAZY`, Hibernate —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–æ–∫—Å–∏ –¥–ª—è —ç—Ç–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏.
    
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**: –ü—Ä–æ–∫—Å–∏ –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–π –æ–±—ã—á–Ω–æ —Å–æ–∑–¥–∞—é—Ç—Å—è, –∫–æ–≥–¥–∞ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å –∞—Å—Å–æ—Ü–∏–∞—Ü–∏—è–º–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏ –≤ —Å—É—â–Ω–æ—Å—Ç–∏ (–æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º –∏–ª–∏ –º–Ω–æ–≥–∏–µ –∫–æ –º–Ω–æ–≥–∏–º).
    
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç**: –ü—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–¥–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `getOrders()`).

```java
@Entity
public class User {
    @Id
    private Long id;
    
    @OneToMany(fetch = FetchType.LAZY)
    private List<Order> orders;  // –ü—Ä–æ–∫—Å–∏ –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏
}


```

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ, –∫–æ–ª–ª–µ–∫—Ü–∏—è `orders` –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –º–µ—Ç–æ–¥—É `getOrders()`.

 3. **–ü—Ä–æ–∫—Å–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (Interface Proxy)**

- **–û–ø–∏—Å–∞–Ω–∏–µ**: Hibernate –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, –µ—Å–ª–∏ —Å—É—â–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –ü—Ä–æ–∫—Å–∏ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —ç—Ç–æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏-–æ–±—ä–µ–∫—Ç—ã –≤ –≤–∏–¥–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, –∞ –Ω–µ –≤ –≤–∏–¥–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤.
    
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**: –ü—Ä–æ–∫—Å–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è, –∫–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç —Å—É—â–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∏ Hibernate –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–∫—Å–∏-–æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å —ç—Ç–æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
    
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç**: –ü—Ä–æ–∫—Å–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–∞–∫ –∂–µ, –∫–∞–∫ –∏ –æ–±—ã—á–Ω—ã–µ –ø—Ä–æ–∫—Å–∏-—Å—É—â–Ω–æ—Å—Ç–∏, –Ω–æ –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å –∫–ª–∞—Å—Å, –æ–Ω–∏ —Ä–µ–∞–ª–∏–∑—É—é—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. –≠—Ç–æ –¥–∞—ë—Ç –≥–∏–±–∫–æ—Å—Ç—å –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Å—É—â–Ω–æ—Å—Ç—è–º–∏.

```java
public interface Identifiable {
    Long getId();
}

@Entity
public class User implements Identifiable {
    @Id
    private Long id;
    
    @Override
    public Long getId() {
        return id;
    }
}

```

–í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ, Hibernate –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–∫—Å–∏-–æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `Identifiable`.

 4. **–ü—Ä–æ–∫—Å–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º bytecode-enhancement (Bytecode Enhancement Proxy)**

- **–û–ø–∏—Å–∞–Ω–∏–µ**: –≠—Ç–æ –æ—Å–æ–±—ã–π —Ç–∏–ø –ø—Ä–æ–∫—Å–∏, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –æ–±—ä–µ–∫—Ç–∞–º–∏ –≤ Hibernate. –ü—Ä–æ–∫—Å–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–π—Ç-–∫–æ–¥–∞ (bytecode enhancement) –Ω–µ —Å–æ–∑–¥–∞—é—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è –ø—Ä–æ–∫—Å–∏, –∞ –∏–∑–º–µ–Ω—è—é—Ç –±–∞–π—Ç-–∫–æ–¥ —Å—É—â–Ω–æ—Å—Ç–∏, –¥–æ–±–∞–≤–ª—è—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏.
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è**: –≠—Ç–æ—Ç —Ç–∏–ø –ø—Ä–æ–∫—Å–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω–æ —É–ª—É—á—à–µ–Ω–∏–µ –±–∞–π—Ç-–∫–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç–∞–∫–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –∫–∞–∫ **Javassist** –∏–ª–∏ **CGLIB**). –ü—Ä–æ–∫—Å–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —É–ª—É—á—à–µ–Ω–∏—è –±–∞–π—Ç-–∫–æ–¥–∞ –ø–æ–∑–≤–æ–ª—è—é—Ç —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ø–æ—Å–∫–æ–ª—å–∫—É –Ω–µ —Ç—Ä–µ–±—É—é—Ç —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ –¥–ª—è –ø—Ä–æ–∫—Å–∏.
- **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç**: –ü—Ä–æ–∫—Å–∏ —Å bytecode enhancement –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –¥–ª—è –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ–ª—è–º —Å—É—â–Ω–æ—Å—Ç–∏ –±–µ–∑ —è–≤–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–∫—Å–∏-–∫–ª–∞—Å—Å–æ–≤.

---
#### 8. FetchType
*LAZY* - –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –Ω–µ —Å—Ä–∞–∑—É, –∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –Ω–∏–º

*EAGER* - —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å—Ä–∞–∑—É –≤–º–µ—Å—Ç–µ —Å –æ—Å–Ω–æ–≤–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç—å—é

- `@OneToMany` `@ManyToMany` - –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è FetchType.LAZY
- `@ManyToOne` `@OneToOne` - –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è FetchType.EAGER

---
#### 9. –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å—É—â–Ω–æ—Å—Ç–∏
–í Hibernate —Å—É—â–Ω–æ—Å—Ç—å –º–æ–∂–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ –æ–¥–Ω–æ–º –∏–∑ —á–µ—Ç—ã—Ä–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π:
{{< figure src="Hibernate_Entity_Life_cycle.png" >}}

- **Transient (–ü–µ—Ä–µ—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ) (new)**
  
–°—É—â–Ω–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω–∞ —Å –ø–æ–º–æ—â—å—é –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ new, –Ω–æ –µ—â–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```java
User user = new User(); // –æ–±—ä–µ–∫—Ç –ø–æ–∫–∞ –Ω–µ —Å–≤—è–∑–∞–Ω —Å –ë–î
user.setName("John"); 
```

- **Persistent (–ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ) (save,persist,update,get)**

–ö–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ EntityManager –∏–ª–∏ Session, –æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–º. –í —ç—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ Hibernate —Å–ª–µ–¥–∏—Ç –∑–∞ –æ–±—ä–µ–∫—Ç–æ–º. –õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–±—ä–µ–∫—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

```java
Session session = sessionFactory.openSession();
session.beginTransaction();
session.save(user); // –æ–±—ä–µ–∫—Ç —Ç–µ–ø–µ—Ä—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ persistent
```

- **Detached (–û—Ç—Å–æ–µ–¥–∏–Ω—ë–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ) (session close)**

–ö–æ–≥–¥–∞ —Å–µ—Å—Å–∏—è –∑–∞–∫—Ä—ã—Ç–∞, –æ–±—ä–µ–∫—Ç –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ detached. –û–Ω –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —Å–≤—è–∑–∞–Ω —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ –±–∞–∑–µ, –Ω–æ –±–æ–ª—å—à–µ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å –Ω–µ–π

```java
session.close(); //  –æ–±—ä–µ–∫—Ç –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –±–¥
```
- **Removed (–£–¥–∞–ª—ë–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)  (delete(obj))**

–ö–æ–≥–¥–∞ —Å—É—â–Ω–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–∞ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –æ–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ removed. –í —ç—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –æ–±—ä–µ–∫—Ç –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ø–∞–º—è—Ç–∏, –Ω–æ —É–∂–µ —É–¥–∞–ª–µ–Ω –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```java
session.delete(); 
```

---
#### 10. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ö—ç—à **1-–≥–æ** —É—Ä–æ–≤–Ω—è
  - –≠—Ç–æ—Ç –∫—ç—à –≤—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å–µ—Å—Å–∏–∏ (—É –∫–∞–∂–¥–æ–π —Å–µ—Å—Å–∏–∏ —Å–≤–æ–π –∫—ç—à –∏ –Ω–µ–ª—å–∑—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –Ω–µ–º—É –∏–∑ –¥—Ä—É–≥–æ–π —Å–µ—Å—Å–∏–∏)
  - –í –∫—ç—à–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å—É—â–Ω–æ—Å—Ç–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–µ `persistent`
  - –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (`persistent`) —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –º–∞–ø–µ, –≥–¥–µ –∫–ª—é—á - ID —Å—É—â–Ω–æ—Å—Ç–∏, –∞ –∑–Ω–∞—á–µ–Ω–∏–µ - —Å–∞–º–∏ –æ–±—ä–µ–∫—Ç—ã-—Å—É—â–Ω–æ—Å—Ç–∏
  - –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö Hibernate –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–º–µ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
  - –ü—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–µ—Å—Å–∏–∏ - –∫—ç—à —É–¥–∞–ª—è–µ—Ç—Å—è

- –ö—ç—à **2-–≥–æ** —É—Ä–æ–≤–Ω—è
  - –≠—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫—ç—à, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–¥–æ –≤–∫–ª—é—á–∞—Ç—å –≤—Ä—É—á–Ω—É—é
  - –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ `SessionFactory` 
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  - –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è `SessionFactory` - –≤–µ—Å—å –∫—ç—à, —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å –Ω–∏–º, —É–º–∏—Ä–∞–µ—Ç

- –ö—ç—à **3-–≥–æ** —É—Ä–æ–≤–Ω—è
  - –ö—ç—à–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ (–∫—ç—à–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–±–æ—Ä–∫–∏)

---
#### 11. HQL –∏ JPQL
–Ø–≤–ª—è—é—Ç—Å—è –æ–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —è–∑—ã–∫–∞–º–∏ –∑–∞–ø—Ä–æ—Å–æ–≤, —Å—Ö–æ–∂–∏–º–∏ –ø–æ –ø—Ä–∏—Ä–æ–¥–µ —Å SQL

*HQL* –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –∏ —Ä–∞—Å—à–∏—Ä—è–µ—Ç JPQL

*JPQL* - —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç JPA, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤—Å–µ–º–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è–º–∏ JPA, –∞ HQL - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Hibernate

---
#### 12. EntityManager + EntityManagerFactory / SessionFactory + session
–†–∞–∑–Ω–∏—Ü–∞ –≤ —Ç–æ–º, –≥–¥–µ –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è. 

EntityManager –∏ EntityManagerFactory - —ç—Ç–æ *JPA*.

Session –∏ SessionFactory - *Hibernate*. 

Session - –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –≤ Hibernate. –°–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑ SessionFactory 

---
#### 13. –ü—Ä–æ–±–ª–µ–º–∞ N + 1. –°–ø–æ—Å–æ–±—ã —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã
–≠—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–µ–ª–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –∫–æ–≥–¥–∞ –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏—Å—å –æ–¥–Ω–∏–º.

**–ü—Ä–∏–º–µ—Ä:**

–ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —É —Ç–µ–±—è –µ—Å—Ç—å –¥–≤–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏: User (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å) –∏ Order (–∑–∞–∫–∞–∑). –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –º–Ω–æ–≥–æ –∑–∞–∫–∞–∑–æ–≤.

–î–æ–ø—É—Å—Ç–∏–º, —Ç—ã —Ö–æ—á–µ—à—å –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Ö –∑–∞–∫–∞–∑–æ–≤. –ü—Ä–æ–±–ª–µ–º–∞ N+1 –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Ö –∑–∞–∫–∞–∑–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–Ω–∞—á–∞–ª–∞ –¥–µ–ª–∞–µ—Ç 1 –∑–∞–ø—Ä–æ—Å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∞ –∑–∞—Ç–µ–º –¥–µ–ª–∞–µ—Ç N –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Äî –ø–æ –æ–¥–Ω–æ–º—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –µ–≥–æ –∑–∞–∫–∞–∑—ã

```java
@Entity
public class User {
    @Id
    private Long id;

    private String name;

    @OneToMany(mappedBy = "user", fetch = FetchType.LAZY)
    private List<Order> orders;
}

@Entity
public class Order {
    @Id
    private Long id;

    private String item;

    @ManyToOne
    @JoinColumn(name = "user_id")
    private User user;
}
```

---
**–ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã N + 1**
- JOIN FETCH. –≠—Ç–æ —Å–ø–æ—Å–æ–± —Å–∫–∞–∑–∞—Ç—å Hibernate –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–º–µ—Å—Ç–µ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ (—Ç–∏–ø–∞ –æ–±—ã—á–Ω–æ–≥–æ JOIN-–∞)

```java
@Query("SELECT u FROM User u JOIN FETCH u.orders")
List<User> findAllUsersWithOrders();
```

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `FetchType.EAGER` –≤–º–µ—Å—Ç–æ `FetchType.LAZY`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å EntityGraph. –£–∫–∞–∑—ã–≤–∞–µ–º, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö, –Ω–µ –∏–∑–º–µ–Ω—è—è —Å—É—â–Ω–æ—Å—Ç–∏ (–∫–∞–∫ –≤ —Å–ª—É—á–∞–µ —Å –∂–∞–¥–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π)

```java
@EntityGraph(attributePaths = {"orders"})
List<User> findAll();
```

---
#### 14. –ß—Ç–æ —Ç–∞–∫–æ–µ Entity Graph?
*Entity Graph* ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –≤ JPA, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö, –æ–ø—Ä–µ–¥–µ–ª—è—è, –∫–∞–∫–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—Ä–∞–∑—É (eager) –∏–ª–∏ –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ (lazy). –≠—Ç–æ –¥–∞–µ—Ç –≥–∏–±–∫–æ—Å—Ç—å –≤ –≤—ã–±–æ—Ä–µ –ø–æ–ª–µ–π –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∑–∞–ø—Ä–æ—Å–∞.

---
***–ö–∞–∫ —Å–æ–∑–¥–∞—Ç—å?***

–°–æ–∑–¥–∞–µ—Ç—Å—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–µ–π `@NamedEntityGraph` –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∏–ª–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ API.

---
***–ß—Ç–æ –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º?***

Entity Graph—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤, –¥–æ–±–∞–≤–ª—è—è –Ω—É–∂–Ω—ã–µ JOIN-—ã –∏ –≤—ã–±–∏—Ä–∞—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è.

---
***–ö–∞–∫ –∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è?***

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–º–µ–Ω–∏ –≥—Ä–∞—Ñ–∞:**

```java
EntityManager entityManager = ...;

Map<String, Object> properties = new HashMap<>();
properties.put("javax.persistence.loadgraph", entityManager.getEntityGraph("User.withRoles"));

User user = entityManager.find(User.class, 1L, properties);

```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –≥—Ä–∞—Ñ–∞:**

```java
EntityManager entityManager = ...;

EntityGraph<User> entityGraph = entityManager.createEntityGraph(User.class);
entityGraph.addAttributeNodes("roles");

Map<String, Object> properties = new HashMap<>();
properties.put("javax.persistence.loadgraph", entityGraph);

User user = entityManager.find(User.class, 1L, properties);

```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Spring Data JPA:**

```java
@Repository
public interface UserRepository extends JpaRepository<User, Long> {

    @EntityGraph(attributePaths = {"roles"})
    User findByName(String name);
}

```

---
#### 15. Statement, Prepared statement, Callable statement
- *Statement* - –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Å—Ç—ã—Ö SQL –∑–∞–ø—Ä–æ—Å–æ–≤. –£—è–∑–≤–∏–º –∫ SQL –∏–Ω—ä–µ–∫—Ü–∏—è–º

- *PreparedStatement*
  - –î–æ–±–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –≤—Å—Ç–∞–≤–∫–∏ –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
  - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç SQL –∏–Ω—ä–µ–∫—Ü–∏–∏
  - –ë—ã—Å—Ç—Ä–µ–µ —á–µ–º Statement, –ø–æ—Ç–æ–º—É —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

- *CallableStatement* - –¥–ª—è –≤—ã–∑–æ–≤–∞ —Ö—Ä–∞–Ω–∏–º—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä

---
#### 16. –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ –≤ ORM
  1. OneToOne
  2. OneToMany, ManyToOne
  3. ManyToMany

---
***–ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–≤—è–∑—å ManyToMany?***

–î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–∞–∫–æ–≥–æ –≤–∏–¥–∞ —Å–≤—è–∑–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –æ–±–µ–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
*–ü—Ä–∏–º–µ—Ä*: –£—á–∏—Ç–µ–ª—è –º–æ–≥—É—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤, –∫–∞–∂–¥—ã–π –ø—Ä–µ–¥–º–µ—Ç –º–æ–∂–µ—Ç –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è–º–∏

```java
@Entity
public class Student {
    @Id @GeneratedValue
    private Long id;

    @ManyToMany
    @JoinTable(
        name = "student_course",
        joinColumns = @JoinColumn(name = "student_id"),
        inverseJoinColumns = @JoinColumn(name = "course_id")
    )
    private List<Course> courses;
}

@Entity
public class Course {
    @Id @GeneratedValue
    private Long id;

    @ManyToMany(mappedBy = "courses")
    private List<Student> students;
}

```

---
***–ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–≤—è–∑—å OneToMany?***

–û–¥–Ω–æ–º—É –æ–±—ä–µ–∫—Ç—É –æ–¥–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ–±—ä–µ–∫—Ç–æ–≤ –¥—Ä—É–≥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏.

```java
@Entity
public class Department {
    @Id @GeneratedValue
    private Long id;

    @OneToMany(mappedBy = "department", cascade = CascadeType.ALL)
    private List<Employee> employees;
}

@Entity
public class Employee {
    @Id @GeneratedValue
    private Long id;

    @ManyToOne
    private Department department;
}

```

---
***–ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–≤—è–∑—å ManyToOne?***

–ú–Ω–æ–∂–µ—Å—Ç–≤—É –æ–±—ä–µ–∫—Ç–æ–≤ –æ–¥–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç –¥—Ä—É–≥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏.

```java
@Entity
public class Employee {
    @Id @GeneratedValue
    private Long id;

    @ManyToOne
    @JoinColumn(name = "department_id")
    private Department department;
}

@Entity
public class Department {
    @Id @GeneratedValue
    private Long id;
}

```

---
***–í —á–µ–º –æ—Ç–ª–∏—á–∏—è –º–µ–∂–¥—É —Å–≤—è–∑—è–º–∏?***

|–¢–∏–ø —Å–≤—è–∑–∏|–°—É—Ç—å|–ü—Ä–∏–º–µ—Ä –æ—Ç–Ω–æ—à–µ–Ω–∏–π|–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏|–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö|
|---|---|---|---|---|
|**OneToOne**|–û–¥–∏–Ω –∫ –æ–¥–Ω–æ–º—É|–ü–∞—Å–ø–æ—Ä—Ç –∏ –≤–ª–∞–¥–µ–ª–µ—Ü|–ö–∞–∂–¥–∞—è —Å—É—â–Ω–æ—Å—Ç—å —Å–≤—è–∑–∞–Ω–∞ —Å –æ–¥–Ω–æ–π –¥—Ä—É–≥–æ–π —Å—É—â–Ω–æ—Å—Ç—å—é|–û–¥–∏–Ω –∏–∑ –æ–±—ä–µ–∫—Ç–æ–≤ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á|
|**OneToMany**|–û–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º|–î–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏|–û–¥–∏–Ω –æ–±—ä–µ–∫—Ç —Å–≤—è–∑–∞–Ω —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏ –¥—Ä—É–≥–æ–π —Å—É—â–Ω–æ—Å—Ç–∏|–û–¥–∏–Ω –≤–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ "–º–Ω–æ–≥–∏—Ö"|
|**ManyToOne**|–ú–Ω–æ–≥–∏–µ –∫ –æ–¥–Ω–æ–º—É|–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –∏ –¥–µ–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç|–û–±—Ä–∞—Ç–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ `OneToMany`|–í–Ω–µ—à–Ω–∏–π –∫–ª—é—á –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ "–º–Ω–æ–≥–∏—Ö"|
|**ManyToMany**|–ú–Ω–æ–≥–∏–µ –∫–æ –º–Ω–æ–≥–∏–º|–°—Ç—É–¥–µ–Ω—Ç—ã –∏ –∫—É—Ä—Å—ã|–ú–Ω–æ–∂–µ—Å—Ç–≤—É –æ–±—ä–µ–∫—Ç–æ–≤ –æ–¥–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –¥—Ä—É–≥–æ–π|–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞|

---
***OneToMany: —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É List –∏ Set***

|–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞|`List`|`Set`|
|---|---|---|
|**–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å**|–î–æ–ø—É—Å–∫–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã|–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —ç–ª–µ–º–µ–Ω—Ç–æ–≤|
|**–ü–æ—Ä—è–¥–æ–∫**|–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è|–ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫|
|**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**|–ú–µ–¥–ª–µ–Ω–Ω–µ–µ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –Ω–∞–ª–∏—á–∏—è|–ë—ã—Å—Ç—Ä–µ–µ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –Ω–∞–ª–∏—á–∏—è|
|**–ò—Å–ø–æ–ª—å–∑—É–µ–º–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è**|`ArrayList` –∏–ª–∏ `LinkedList`|–û–±—ã—á–Ω–æ `HashSet` –∏–ª–∏ `TreeSet`|

---
***–ü–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã Cascade***

 **üîπ –ß—Ç–æ —Ç–∞–∫–æ–µ `Cascade`?**

`Cascade` –≤ JPA –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —á—Ç–æ –¥–µ–ª–∞—Ç—å —Å –∑–∞–≤–∏—Å–∏–º—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞.

üìå **–ü—Ä–∏–º–µ—Ä:**

```java
@Entity
class Parent {
    @Id @GeneratedValue
    private Long id;

    @OneToMany(mappedBy = "parent", cascade = CascadeType.ALL)
    private List<Child> children;
}

@Entity
class Child {
    @Id @GeneratedValue
    private Long id;

    @ManyToOne
    @JoinColumn(name = "parent_id")
    private Parent parent;
}
```

–ï—Å–ª–∏ —É–¥–∞–ª–∏—Ç—å `Parent`, —Ç–æ **–≤—Å–µ `Child` –æ–±—ä–µ–∫—Ç—ã —Ç–æ–∂–µ —É–¥–∞–ª—è—Ç—Å—è!**

 **üîπ –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã `CascadeType`**

|**–¢–∏–ø**|**–û–ø–∏—Å–∞–Ω–∏–µ**|
|---|---|
|`ALL`|–ü—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ –≤–∏–¥—ã –∫–∞—Å–∫–∞–¥–∞ (`PERSIST`, `REMOVE`, `MERGE`, `REFRESH`, `DETACH`)|
|`PERSIST`|–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–≤–∏—Å–∏–º—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏|
|`REMOVE`|–£–¥–∞–ª—è–µ—Ç –∑–∞–≤–∏—Å–∏–º—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏|
|`MERGE`|–û–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–≤–∏—Å–∏–º—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏|
|`REFRESH`|–ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∏–∑ –ë–î|
|`DETACH`|–£–¥–∞–ª—è–µ—Ç –∑–∞–≤–∏—Å–∏–º—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–Ω–æ –Ω–µ –∏–∑ –ë–î)|

 **–ü–ª—é—Å—ã –∏ –º–∏–Ω—É—Å—ã `Cascade`**

‚úÖ **–ü–ª—é—Å—ã:**

- –£–ø—Ä–æ—â–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å –∑–∞–≤–∏—Å–∏–º—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç `save()` –∏ `delete()`
- –£–º–µ–Ω—å—à–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ `EntityManager` –≤—ã–∑–æ–≤–æ–≤

‚ùå **–ú–∏–Ω—É—Å—ã:**

- –ú–æ–∂–µ—Ç **–Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ —É–¥–∞–ª–∏—Ç—å –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** (`REMOVE` –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏)
- `ALL` –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ **–Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω—ã–º –∫–∞—Å–∫–∞–¥–Ω—ã–º –æ–ø–µ—Ä–∞—Ü–∏—è–º**
- –ú–æ–∂–µ—Ç **–Ω–∞–≥—Ä—É–∂–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö**, –µ—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---
#### 17. LazyInitializationException
–≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç –±—ã–ª –∑–∞–≥—Ä—É–∂–µ–Ω —Å –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π, –Ω–æ –µ–≥–æ –¥–∞–Ω–Ω—ã–µ –ø—ã—Ç–∞—é—Ç—Å—è –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏

```java
public void printAuthorBooks(Long authorId) {
    Session session = sessionFactory.openSession();
    Author author = session.get(Author.class, authorId);
    session.close();
    
    // –ü–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–µ–Ω–∏–≤–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–µ—Å—Å–∏–∏
    System.out.println(author.getBooks());  // –ú–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å LazyInitializationException
}
```

- –ö–∞–∫ —Ä–µ—à–∏—Ç—å?
  - JOIN FETCH. –≠—Ç–æ —Å–ø–æ—Å–æ–± —Å–∫–∞–∑–∞—Ç—å Hibernate –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–º–µ—Å—Ç–µ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ (—Ç–∏–ø–∞ –æ–±—ã—á–Ω–æ–≥–æ JOIN-–∞)
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å EntityGraph. –£–∫–∞–∑—ã–≤–∞–µ–º, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö, –Ω–µ –∏–∑–º–µ–Ω—è—è —Å—É—â–Ω–æ—Å—Ç–∏ (–∫–∞–∫ –≤ —Å–ª—É—á–∞–µ —Å –∂–∞–¥–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π) 

---
#### 18. –ß—Ç–æ —Ç–∞–∫–æ–µ SQL-–∏–Ω—ä–µ–∫—Ü–∏—è?
–≠—Ç–æ —Ç–∏–ø —É—è–∑–≤–∏–º–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞–º –≤–º–µ—à–∏–≤–∞—Ç—å—Å—è –≤ –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```sql
SELECT * FROM users WHERE username = 'user' OR '1'='1' AND password = 'password';
```

- –ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è SQL –∏–Ω—ä–µ–∫—Ü–∏–π:
  - –í–æ–π–¥–µ—Ç –≤ —Å–∏—Å—Ç–µ–º—É –æ–±—Ö–æ–¥—è –ø—Ä–æ–≤–µ—Ä–∫—É –ª–æ–≥–∏–Ω–∞ –∏ –ø–∞—Ä–æ–ª—è
  - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–¥–∞–ª–∏—Ç—å –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
  - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ë–î
  - –î–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

- –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å:
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PreparedStatement
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Hibernate

---
#### 19. –ü—Ä–æ–±–ª–µ–º—ã JOIN FETCH
- –ü—Ä–æ–±–ª–µ–º–∞
  - –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏ —Å –µ—ë —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã

- –†–µ—à–µ–Ω–∏–µ
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DISTINCT, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ 
   ```sql
   SELECT DISTINCT o FROM Order o JOIN FETCH o.items
   ```
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Set –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–≤—è–∑–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤

---
#### 20. –õ–æ–≥–∏ –≤ Hibernate
Hibernate –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ —á–µ—Ä–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏—é `org.hibernate.SQL`. –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π. –í–∫–ª—é—á–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å –æ—Ç–ª–∞–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∏–ª–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏, –Ω–æ –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∑–∞–ø—Ä–æ—Å–æ–≤.

```java
log4j.logger.org.hibernate.SQL=DEBUG
log4j.logger.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
```

---
#### 21. –ê–Ω–Ω–æ—Ç–∞—Ü–∏—è @Query, —á—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ?

–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è `@Query` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Spring Data JPA –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö SQL-–∑–∞–ø—Ä–æ—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö.

–≠—Ç–∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –ª–∏–±–æ –≤ –≤–∏–¥–µ JPQL (Java Persistence Query Language), –ª–∏–±–æ –≤ –≤–∏–¥–µ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞–ø—Ä—è–º—É—é.

–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `@Query`:

1. **JPQL-–∑–∞–ø—Ä–æ—Å—ã** (Java Persistence Query Language)

```java
public interface UserRepository extends JpaRepository<User, Long> {

    // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ JPQL –¥–ª—è –≤—ã–±–æ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö
    @Query("SELECT u FROM User u WHERE u.name = :name")
    List<User> findByName(@Param("name") String name);
}

```

2. **SQL-–∑–∞–ø—Ä–æ—Å—ã**

```java
public interface UserRepository extends JpaRepository<User, Long> {

    // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–∞
    @Query(value = "SELECT * FROM users WHERE name = :name", nativeQuery = true)
    List<User> findByNameNative(@Param("name") String name);
}

```

3. **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö**

```java
@Query("SELECT u FROM User u WHERE u.name = :name")
List<User> findByName(@Param("name") String name);

```

---
#### 22. –ö–∞–∫ Hibernate –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL –∑–∞–ø—Ä–æ—Å—ã?

Hibernate –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Å—É—â–Ω–æ—Å—Ç—è–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π, —Ç–∞–∫–∏—Ö –∫–∞–∫ `@Entity`, `@OneToMany`, `@ManyToOne`, –∏ –¥—Ä—É–≥–∏—Ö. –û—Å–Ω–æ–≤–Ω—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –≤–∫–ª—é—á–∞—é—Ç `INSERT`, `SELECT`, `UPDATE`, `DELETE`. –¢–∞–∫–∂–µ Hibernate –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ JPQL –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ –Ω–∞—Ç–∏–≤–Ω—ã—Ö SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.

1. Hibernate –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–µ—Ç–∞–º–æ–¥–µ–ª—å —Å—É—â–Ω–æ—Å—Ç–µ–π, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∫–∞–∫ –æ–±—ä–µ–∫—Ç—ã —Å–æ–ø–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏.
2. –¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏ (CRUD) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–æ–π SQL-–∑–∞–ø—Ä–æ—Å –Ω—É–∂–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å.
3. –î–∏–∞–ª–µ–∫—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—ë—Ç –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ SQL.
4. –ó–∞–ø—Ä–æ—Å—ã —Å—Ç—Ä–æ—è—Ç—Å—è —Å —É—á—ë—Ç–æ–º –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π (`@Lazy`, `@Eager`) –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ API (JPQL, Criteria –∏–ª–∏ Native SQL).
5. Hibernate –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å—ã —Å —É—á—ë—Ç–æ–º —Å–≤—è–∑–µ–π, –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è.

---
#### 23. Hibernate. –ß—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Persistence Context? –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—ä–µ–∫—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Persistence Context?

`Persistence Context` (–∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏) –≤ Hibernate ‚Äî —ç—Ç–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –≥–¥–µ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏–ª–∏ —Å–µ—Å—Å–∏–∏. –û–Ω–æ –≤—ã—Å—Ç—É–ø–∞–µ—Ç –∫–∞–∫ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Å–ª–æ–π –º–µ–∂–¥—É –æ–±—ä–µ–∫—Ç–∞–º–∏ Java –∏ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö, –ø–æ–∑–≤–æ–ª—è—è Hibernate –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Ö —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

**–í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è**:
- **–£–ø—Ä–∞–≤–ª—è–µ–º—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏** (managed entities):
	- –≠—Ç–æ –æ–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –Ω–µ–π –≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏.
	- –≠—Ç–∏ –æ–±—ä–µ–∫—Ç—ã Hibernate –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç (tracking) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.

- **–ö—ç—à –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è** (First Level Cache):
	- –í—Å–µ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∏ –∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∫—ç—à–µ –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–º –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–µ—Å—Å–∏–∏.
	- –ï—Å–ª–∏ –≤—ã –∑–∞–ø—Ä–æ—Å–∏—Ç–µ –æ–±—ä–µ–∫—Ç –ø–æ –ø–µ—Ä–≤–∏—á–Ω–æ–º—É –∫–ª—é—á—É, Hibernate —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç –Ω–∞–ª–∏—á–∏–µ –µ–≥–æ –≤ –∫—ç—à–µ, –ø—Ä–µ–∂–¥–µ —á–µ–º –≤—ã–ø–æ–ª–Ω—è—Ç—å SQL-–∑–∞–ø—Ä–æ—Å.

- **–ö–æ–ø–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π –æ–±—ä–µ–∫—Ç–æ–≤**:
	- Hibernate —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –ø—Ä–∏ –µ–≥–æ –∑–∞–≥—Ä—É–∑–∫–µ. –≠—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –±—ã–ª–∏ –ª–∏ –≤–Ω–µ—Å–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è (dirty checking).
	
- **–ö–æ–Ω—Ç—Ä–æ–ª—å –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏**:
	- Hibernate –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –æ–±—ä–µ–∫—Ç –Ω–µ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–≤–∞–∂–¥—ã –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏.

- **–û—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (Lazy Loading)**:
	- Hibernate –º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–∫—Å–∏-–æ–±—ä–µ–∫—Ç—ã –¥–ª—è –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π. –≠—Ç–∏ –ø—Ä–æ–∫—Å–∏ –∑–∞–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏.

---
***–°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—ä–µ–∫—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Psersistence Context?***

- –î–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏.
- –î–æ —è–≤–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è (`evict` –∏–ª–∏ `clear`).
- –î–æ —Ç–æ–≥–æ, –∫–∞–∫ –æ–±—ä–µ–∫—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –æ—Ç—Å–æ–µ–¥–∏–Ω—ë–Ω–Ω—ã–º.

---
#### 24. Hibernate –∏ Lombok

 **–ü—Ä–æ–±–ª–µ–º–∞ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ `@Data` –≤ Hibernate**

Lombok –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è `@Data` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç:  
‚úÖ `getter` –∏ `setter`  
‚úÖ `toString()`  
‚úÖ `equals()` –∏ `hashCode()`

–ù–æ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Hibernate –æ–Ω–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º –∏–∑-–∑–∞ –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ (`FetchType.LAZY`).

 **üîπ –ü—Ä–æ–±–ª–µ–º–∞ —Å `toString()`**

üìå –ï—Å–ª–∏ –≤ `@Data` –µ—Å—Ç—å `@OneToMany(fetch = FetchType.LAZY)`, —Ç–æ Hibernate **—Å–æ–∑–¥–∞–µ—Ç –ø—Ä–æ–∫—Å–∏-–æ–±—ä–µ–∫—Ç**, –∞ Lombok –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç `toString()`, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ **LazyInitializationException**.

```java
@Entity
@Data
public class User {
    @Id @GeneratedValue
    private Long id;
    private String name;

    @OneToMany(mappedBy = "user", fetch = FetchType.LAZY)
    private List<Order> orders;
}
```

üìå **–û—à–∏–±–∫–∞:**

```java
User user = session.get(User.class, 1L);
System.out.println(user); // ‚ùå LazyInitializationException
```

üìå **–†–µ—à–µ–Ω–∏–µ:**  
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@ToString.Exclude` –∏–ª–∏ `@EqualsAndHashCode.Exclude`

```java
@Entity
@Data
public class User {
    @Id @GeneratedValue
    private Long id;
    private String name;

    @OneToMany(mappedBy = "user", fetch = FetchType.LAZY)
    @ToString.Exclude
    @EqualsAndHashCode.Exclude
    private List<Order> orders;
}
```


 **üîπ –ü—Ä–æ–±–ª–µ–º–∞ —Å `equals()` –∏ `hashCode()`**

üìå **Lombok –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å–µ –ø–æ–ª—è**, –≤–∫–ª—é—á–∞—è `@OneToMany`, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π —Ä–µ–∫—É—Ä—Å–∏–∏.

üìå **–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@EqualsAndHashCode(onlyExplicitlyIncluded = true)`.

```java
@Entity
@Data
@EqualsAndHashCode(onlyExplicitlyIncluded = true)
public class User {
    @Id @GeneratedValue
    @EqualsAndHashCode.Include
    private Long id;

    private String name;

    @OneToMany(mappedBy = "user", fetch = FetchType.LAZY)
    @ToString.Exclude
    private List<Order> orders;
}
```

‚úÖ –¢–µ–ø–µ—Ä—å `equals()` –∏ `hashCode()` –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **—Ç–æ–ª—å–∫–æ `id`**, –∞ `toString()` –Ω–µ –≤—ã–∑–æ–≤–µ—Ç `LazyInitializationException`.

---
#### 25. –ö–∞–∫ JPA –¥–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã?

JPA –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ **EntityManager**, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å—É—â–Ω–æ—Å—Ç—è–º–∏ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å Hibernate.

 **1Ô∏è‚É£ –ú–µ—Ç–æ–¥—ã `EntityManager`**

|**–ú–µ—Ç–æ–¥**|**–û–ø–∏—Å–∞–Ω–∏–µ**|
|---|---|
|`find(Class, id)`|–ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å—É—â–Ω–æ—Å—Ç—å –ø–æ `id` (–≤—ã–ø–æ–ª–Ω—è–µ—Ç `SELECT * FROM ... WHERE id = ?`)|
|`persist(entity)`|–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–æ–≤—É—é —Å—É—â–Ω–æ—Å—Ç—å (`INSERT INTO ...`)|
|`merge(entity)`|–û–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—É—â–Ω–æ—Å—Ç—å (`UPDATE ... SET ... WHERE id = ?`)|
|`remove(entity)`|–£–¥–∞–ª—è–µ—Ç —Å—É—â–Ω–æ—Å—Ç—å (`DELETE FROM ... WHERE id = ?`)|
|`createQuery("HQL/JPQL")`|–í—ã–ø–æ–ª–Ω—è–µ—Ç JPQL-–∑–∞–ø—Ä–æ—Å—ã|
|`createNativeQuery("SQL")`|–í—ã–ø–æ–ª–Ω—è–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å—ã|

üìå **–ü—Ä–∏–º–µ—Ä:**

```java
User user = entityManager.find(User.class, 1L); // SELECT * FROM users WHERE id = 1
entityManager.remove(user); // DELETE FROM users WHERE id = 1
```


 **2Ô∏è‚É£ –ó–∞–ø—Ä–æ—Å—ã –≤ Hibernate: JPQL –∏ HQL**

**JPQL (Java Persistence Query Language)** ‚Äì –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ JPA.  
**HQL (Hibernate Query Language)** ‚Äì —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è JPQL.

üìå **JPQL –ø—Ä–∏–º–µ—Ä:**

```java
TypedQuery<User> query = entityManager.createQuery(
    "SELECT u FROM User u WHERE u.name = :name", User.class
);
query.setParameter("name", "Alex");
List<User> users = query.getResultList();
```

üîπ **–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ SQL:**

```sql
SELECT * FROM users WHERE name = 'Alex';
```

üìå **HQL –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ Hibernate:**

```java
List<User> users = session.createQuery(
    "FROM User u WHERE u.name LIKE :name", User.class
)
.setParameter("name", "%Alex%")
.getResultList();
```

 **3Ô∏è‚É£ –ö–∞–∫ Hibernate –≤—ã–ø–æ–ª–Ω—è–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å—ã?**

üìå **Hibernate –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 3 —ç—Ç–∞–ø–∞:**   
**–ó–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ HQL/JPQL.**  
**Hibernate –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –µ–≥–æ –≤ SQL.**  
**–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è SQL-–∑–∞–ø—Ä–æ—Å –∫ –ë–î.**

üìå **–ü—Ä–∏–º–µ—Ä:**

```java
User user = session.get(User.class, 1L);
```

üîπ **Hibernate –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —ç—Ç–æ –≤ SQL:**

```sql
SELECT * FROM users WHERE id = 1;
```

---
#### 26. –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –≤ Hibernate

1. **`SINGLE_TABLE` (–û–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –Ω–∞ –∏–µ—Ä–∞—Ä—Ö–∏—é)**

–í—Å–µ –∫–ª–∞—Å—Å—ã‚Äì–Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ, —Å –∫–æ–ª–æ–Ω–∫–æ–π‚Äë–¥–∏—Åcriminator‚Äô–æ–º –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–∏–ø–∞.

```java
@Entity
@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn(name = "dtype", discriminatorType = DiscriminatorType.STRING)
public abstract class Vehicle {
    @Id @GeneratedValue
    private Long id;
    private String manufacturer;
    // getters/setters...
}

@Entity
@DiscriminatorValue("CAR")
public class Car extends Vehicle {
    private int seatingCapacity;
    // getters/setters...
}

@Entity
@DiscriminatorValue("TRUCK")
public class Truck extends Vehicle {
    private double payloadCapacity;
    // getters/setters...
}
```

- **–ü–ª—é—Å—ã**: –µ–¥–∏–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ ‚Üí –ø—Ä–æ—Å—Ç–æ–π `JOIN`‚Äëfree –∑–∞–ø—Ä–æ—Å; –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è.

- **–ú–∏–Ω—É—Å—ã**: –º–Ω–æ–≥–æ nullable‚Äë–∫–æ–ª–æ–Ω–æ–∫ (–¥–ª—è –ø–æ–ª–µ–π –≤—Å–µ—Ö –ø–æ–¥–∫–ª–∞—Å—Å–æ–≤); —Ç–∞–±–ª–∏—Ü–∞ —Ä–∞—Å—Ç—ë—Ç ‚Äú—à–∏—Ä–∏–Ω–æ–π‚Äù.


2. **`TABLE_PER_CLASS` (–û—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Å–∞)**

–ö–∞–∂–¥—ã–π –∫–ª–∞—Å—Å –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ—é —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É —Å–æ –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏, –≤–∫–ª—é—á–∞—è —É–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã–µ.

```java
@Entity
@Inheritance(strategy = InheritanceType.TABLE_PER_CLASS)
public abstract class Vehicle {
    @Id @GeneratedValue
    private Long id;
    private String manufacturer;
}

@Entity
public class Car extends Vehicle {
    private int seatingCapacity;
}

@Entity
public class Truck extends Vehicle {
    private double payloadCapacity;
}
```

- **–ü–ª—é—Å—ã**: –Ω–µ—Ç –ª–∏—à–Ω–∏—Ö nullable‚Äë–ø–æ–ª–µ–π, –º–æ–¥–µ–ª—å ‚Äú—á–∏—Å—Ç–æ–π‚Äù –æ–±—ä–µ–∫—Ç–Ω–æ‚Äë—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏.

- **–ú–∏–Ω—É—Å—ã**: `UNION`‚Äë–∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏ –≤—ã–±–æ—Ä–∫–µ –≤—Å–µ—Ö `Vehicle`; —Å–ª–æ–∂–Ω–µ–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–≤—Ç–æ‚Äë–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–æ–≤ (–Ω–µ –≤–æ –≤—Å–µ—Ö –°–£–ë–î).


3. **`JOINED` (–ü–æ‚Äë—Ç–∞–±–ª–∏—Ü–∞–º —Å `JOIN`)**

–ö–æ—Ä–Ω–µ–≤–æ–π –∫–ª–∞—Å—Å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ, –∫–∞–∂–¥—ã–π –ø–æ–¥–∫–ª–∞—Å—Å ‚Äì –≤ —Å–≤–æ–µ–π, –ø—Ä–∏—á—ë–º —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–¥–∫–ª–∞—Å—Å–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ‚ÄëFK –Ω–∞ –∫–æ—Ä–Ω–µ–≤—É—é.

```java
@Entity
@Inheritance(strategy = InheritanceType.JOINED)
public abstract class Vehicle {
    @Id @GeneratedValue
    private Long id;
    private String manufacturer;
}

@Entity
@Table(name = "car")
public class Car extends Vehicle {
    private int seatingCapacity;
}

@Entity
@Table(name = "truck")
public class Truck extends Vehicle {
    private double payloadCapacity;
}
```

- **–ü–ª—é—Å—ã**: –Ω–µ—Ç nullable‚Äë–ø–æ–ª–µ–π, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ ‚Äú—á–∏—Å—Ç–∞—è‚Äù, –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å.

- **–ú–∏–Ω—É—Å—ã**: `JOIN`‚Äë—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–¥–∫–ª–∞—Å—Å–æ–≤; —á—É—Ç—å –±–æ–ª–µ–µ –Ω–∏–∑–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–∫–∏.


4. **`@MappedSuperclass` (–ù–µ —Ç–∞–±–ª–∏—Ü–∞‚Äë—Å—É–ø–µ—Ä–∫–ª–∞—Å—Å)**

–ê–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—É–ø–µ—Ä–∫–ª–∞—Å—Å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å—É—â–Ω–æ—Å—Ç—å—é –∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–µ–π —Ç–∞–±–ª–∏—Ü—ã; –µ–≥–æ –ø–æ–ª—è —É–Ω–∞—Å–ª–µ–¥—É—é—Ç —Ç–∞–±–ª–∏—Ü—ã –ø–æ–¥–∫–ª–∞—Å—Å–æ–≤.

```java
@MappedSuperclass
public abstract class BaseEntity {
    @Id @GeneratedValue
    private Long id;
    private LocalDateTime createdAt;
}

@Entity
public class User extends BaseEntity {
    private String username;
    private String email;
}

@Entity
public class Product extends BaseEntity {
    private String name;
    private BigDecimal price;
}
```

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –æ–±—â–∏–µ –ø–æ–ª—è –∏ –º–µ—Ç–æ–¥—ã –Ω—É–∂–Ω–æ ‚Äú—Ä–∞–∑–¥–∞—Ç—å‚Äù –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —Å—É—â–Ω–æ—Å—Ç—è–º, –Ω–æ —Å–∞–º–∞ –∏–µ—Ä–∞—Ä—Ö–∏—è –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è.


–ö–æ–≥–¥–∞ –≤—ã–±–∏—Ä–∞—Ç—å –∫–∞–∫—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é

|–°—Ç—Ä–∞—Ç–µ–≥–∏—è|–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è‚Ä¶|–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞|
|---|---|---|
|`SINGLE_TABLE`|–ë—ã—Å—Ç—Ä—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è, –Ω–µ–±–æ–ª—å—à–æ–π –∏–µ—Ä–∞—Ä—Ö–∏–∏|–ù–µ—Ç `JOIN`, –ø—Ä–æ—Å—Ç–æ—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤|
|`TABLE_PER_CLASS`|–ú–Ω–æ–≥–æ —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥–∫–ª–∞—Å—Å–æ–≤ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏|–ß–∏—Å—Ç–∞—è –û‚Äë–† –º–æ–¥–µ–ª—å, –Ω–µ—Ç `null`|
|`JOINED`|–ß—ë—Ç–∫–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, —á–∞—Å—Ç—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º—ã|–ù–µ—Ç –ª–∏—à–Ω–∏—Ö –∫–æ–ª–æ–Ω–æ–∫, –≥–∏–±–∫–æ—Å—Ç—å|
|`@MappedSuperclass`|–û–±—â–∏–µ –ø–æ–ª—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –±–µ–∑ —Ç–∞–±–ª–∏—Ü—ã‚Äë—Å—É–ø–µ—Ä|–ö–æ–¥‚Äë—Ä–µ—é–∑ –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –°–£–ë–î|
